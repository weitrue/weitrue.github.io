<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/img/logo.png">
  <link rel="icon" type="image/png" href="/img/logo.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="我们相信，未来可期！">
  <meta name="author" content="嗯，我们是对的">
  <meta name="keywords" content="">
  <title>【Go】学习笔记 - weitrable</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>WeiTrable</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/book/">
                <i class="iconfont icon-books"></i>
                电子书
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/images/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2021-02-07 09:55">
      2021年2月7日 上午
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      11.9k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      219
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <blockquote>
<p> “Go has indeed become the language of cloud infrastructure” - Rob Pike interview<a id="more"></a></p>
</blockquote>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><h4 id="var与"><a href="#var与" class="headerlink" title="var与:="></a>var与:=</h4><ul>
<li>:=方式较为简洁，但只能在函数内使用该方式，var方式没有这个限制，var方式定义在汉书外的变量属于包内部的变量</li>
<li>函数中以:=方式定义变量为主</li>
</ul>
<h4 id="内建变量类型"><a href="#内建变量类型" class="headerlink" title="内建变量类型"></a>内建变量类型</h4><ul>
<li>bool,string</li>
<li>(u)int, (u)int8, (u)int16, (u)int32, (u)int, uintptr</li>
<li>byte, rune</li>
<li>float32, float64, complex64, complex128</li>
<li>变量类型写在变量名之后</li>
<li>编译器可推测变量类型</li>
<li>没有char, 只有rune</li>
<li>原生支持复数类型</li>
</ul>
<pre><code class="hljs golang"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;fmt&quot;</span>
	<span class="hljs-string">&quot;math&quot;</span>
	<span class="hljs-string">&quot;math/cmplx&quot;</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">euler</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-comment">// 欧拉公式 e^(i*Pi) + 1 = 0</span>
	fmt.Println(cmplx.Exp(<span class="hljs-number">1i</span> * math.Pi) + <span class="hljs-number">1</span>)
  fmt.Println(cmplx.Pow(math.E, <span class="hljs-number">1i</span> * math.Pi) + <span class="hljs-number">1</span>)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
	euler()
&#125;

<span class="hljs-comment">// 打印内容</span>
(<span class="hljs-number">0</span>+<span class="hljs-number">1.2246467991473515e-16i</span>)
(<span class="hljs-number">0</span>+<span class="hljs-number">1.2246467991473515e-16i</span>)</code></pre>

<h4 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h4><p>go语言需要开发时强制类型转换，不会自动隐式转换</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">triangle</span><span class="hljs-params">()</span></span>  &#123;
	a, b := <span class="hljs-number">3</span>, <span class="hljs-number">4</span>
	<span class="hljs-keyword">var</span> c <span class="hljs-keyword">int</span> 
	c = math.Sqrt(a*a + b*b)                    <span class="hljs-comment">// 会在编译前idea便提示报错</span>
  c = <span class="hljs-keyword">int</span>(math.Sqrt(<span class="hljs-keyword">float64</span>(a * a + b * b)))  <span class="hljs-comment">// 正确写法</span>
	fmt.Println(c)
&#125;</code></pre>

<p>常量未声明类型，其类型是不确定的（数值可以作各种类型使用）</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">consts</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-comment">// 强制类型转换</span>
	<span class="hljs-keyword">const</span> a, b = <span class="hljs-number">3</span>, <span class="hljs-number">4</span>
	<span class="hljs-keyword">var</span> c <span class="hljs-keyword">int</span>
	c = <span class="hljs-keyword">int</span>(math.Sqrt(a * a + b * b))    <span class="hljs-comment">// a * a + b * b 部分可以不用加上强制类型转换</span>
	fmt.Println(c)
&#125;</code></pre>

<p>可以利用常量申明枚举类型</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">enums</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-keyword">const</span> (
		golang = <span class="hljs-literal">iota</span>
		_
		java
		python
		)
	fmt.Println(golang, java, python)
&#125;

<span class="hljs-comment">// 输出</span>
<span class="hljs-number">0</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span></code></pre>

<p>可以以<code>iota</code>为基础，生成一系列枚举数</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">enums</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-keyword">const</span> (
		b = <span class="hljs-number">1</span> &lt;&lt; (<span class="hljs-number">10</span> * <span class="hljs-literal">iota</span>)
		kb
		mb
		gb
		tb
	)
	fmt.Println(b, kb, mb, gb, tb)
&#125;

<span class="hljs-comment">// 输出</span>
<span class="hljs-number">1</span> <span class="hljs-number">1024</span> <span class="hljs-number">1048576</span> <span class="hljs-number">1073741824</span> <span class="hljs-number">1099511627776</span></code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/blob/master/go/variable.go">https://github.com/weitrue/note/blob/master/go/variable.go</a></p>
<h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><p>指针不能运算</p>
<pre><code class="hljs go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
	<span class="hljs-keyword">var</span> a <span class="hljs-keyword">int</span> = <span class="hljs-number">2</span>
	<span class="hljs-keyword">var</span> pa *<span class="hljs-keyword">int</span> = &amp;a
	*pa = <span class="hljs-number">3</span>
	fmt.Println(a)
&#125;

<span class="hljs-comment">// 运行结果</span>
<span class="hljs-number">3</span></code></pre>

<p>参数传递—只有<em>值传递</em>一种方式</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">swapV</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>)</span></span> &#123;
	b, a = a, b
	fmt.Println(<span class="hljs-string">&quot;in &quot;</span>, a, b, &amp;a, &amp;b)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">swapRN</span><span class="hljs-params">(a, b *<span class="hljs-keyword">int</span>)</span></span> &#123;
	<span class="hljs-comment">// 局部变量交换值（地址）</span>
	b, a = a, b
	fmt.Println(<span class="hljs-string">&quot;in &quot;</span>, a, b, *a, *b)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">swapR</span><span class="hljs-params">(a, b *<span class="hljs-keyword">int</span>)</span></span> &#123;
	<span class="hljs-comment">// 交换变量值（地址）指向的值</span>
	*b, *a = *a, *b
	fmt.Println(<span class="hljs-string">&quot;in &quot;</span>, a, b, *a, *b)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pointerSwap</span><span class="hljs-params">()</span></span>  &#123;
	a, b := <span class="hljs-number">3</span>, <span class="hljs-number">4</span>
	swapV(a, b)
	fmt.Println(<span class="hljs-string">&quot;out&quot;</span>, a, b, &amp;a, &amp;b)

	a, b = <span class="hljs-number">3</span>, <span class="hljs-number">4</span>
	swapRN(&amp;a, &amp;b)
	fmt.Println(<span class="hljs-string">&quot;out&quot;</span>, a, b, &amp;a, &amp;b)

	a, b = <span class="hljs-number">3</span>, <span class="hljs-number">4</span>
	swapR(&amp;a, &amp;b)
	fmt.Println(<span class="hljs-string">&quot;out&quot;</span>, a, b, &amp;a, &amp;b)

&#125;

<span class="hljs-comment">// 输出</span>
in  <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">0xc00001e0c8</span> <span class="hljs-number">0xc00001e0d0</span>
out <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">0xc00001e0b8</span> <span class="hljs-number">0xc00001e0c0</span>
in  <span class="hljs-number">0xc00001e0c0</span> <span class="hljs-number">0xc00001e0b8</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span>
out <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">0xc00001e0b8</span> <span class="hljs-number">0xc00001e0c0</span>
in  <span class="hljs-number">0xc00001e0b8</span> <span class="hljs-number">0xc00001e0c0</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span>
out <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">0xc00001e0b8</span> <span class="hljs-number">0xc00001e0c0</span></code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/blob/master/go/pointer.go">https://github.com/weitrue/note/blob/master/go/pointer.go</a></p>
<h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><p>数组定义</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">define</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-keyword">var</span> arr1 [<span class="hljs-number">5</span>]<span class="hljs-keyword">int</span>
	arr2 := [<span class="hljs-number">3</span>]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>&#125;
	arr3 := [...]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>&#125;

	<span class="hljs-keyword">var</span> grid [<span class="hljs-number">4</span>][<span class="hljs-number">5</span>]<span class="hljs-keyword">bool</span>
	fmt.Println(arr1, arr2, arr3)
	fmt.Println(grid)
&#125;

<span class="hljs-comment">// 输出</span>
[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>] [<span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span>] [<span class="hljs-number">2</span> <span class="hljs-number">4</span> <span class="hljs-number">6</span> <span class="hljs-number">8</span> <span class="hljs-number">10</span>]
[[<span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span>] [<span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span>] [<span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span>] [<span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span> <span class="hljs-literal">false</span>]]
</code></pre>

<p>[5]int和[10]int是不同类型</p>
<p>调用func f(arr [10]int)会<em>拷贝</em>数组</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">printArr</span><span class="hljs-params">(arr [5]<span class="hljs-keyword">int</span>)</span></span>  &#123;
	arr[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span>
	<span class="hljs-keyword">for</span> i, v := <span class="hljs-keyword">range</span> arr &#123;
		fmt.Println(i, v)
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">arrTest</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-keyword">var</span> arr1 [<span class="hljs-number">5</span>]<span class="hljs-keyword">int</span>
	arr2 := [...]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>, <span class="hljs-number">10</span>&#125;
	fmt.Println()
	printArr(arr2)
	fmt.Println()
	<span class="hljs-keyword">for</span> i, v := <span class="hljs-keyword">range</span> arr1 &#123;
		fmt.Println(i, v)
	&#125;
&#125;

<span class="hljs-comment">// 输出</span>
<span class="hljs-number">0</span> <span class="hljs-number">100</span>
<span class="hljs-number">1</span> <span class="hljs-number">0</span>
<span class="hljs-number">2</span> <span class="hljs-number">0</span>
<span class="hljs-number">3</span> <span class="hljs-number">0</span>
<span class="hljs-number">4</span> <span class="hljs-number">0</span>

<span class="hljs-number">0</span> <span class="hljs-number">100</span>
<span class="hljs-number">1</span> <span class="hljs-number">4</span>
<span class="hljs-number">2</span> <span class="hljs-number">6</span>
<span class="hljs-number">3</span> <span class="hljs-number">8</span>
<span class="hljs-number">4</span> <span class="hljs-number">10</span>

<span class="hljs-number">0</span> <span class="hljs-number">0</span>
<span class="hljs-number">1</span> <span class="hljs-number">0</span>
<span class="hljs-number">2</span> <span class="hljs-number">0</span>
<span class="hljs-number">3</span> <span class="hljs-number">0</span>
<span class="hljs-number">4</span> <span class="hljs-number">0</span></code></pre>

<p>若要改变数组的值 需要传入数组的地址，因此go语言一般不使用数组</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">printArrR</span><span class="hljs-params">(arr *[5]<span class="hljs-keyword">int</span>)</span></span>  &#123;
	arr[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span>
	<span class="hljs-keyword">for</span> i, v := <span class="hljs-keyword">range</span> arr &#123;
		fmt.Println(i, v)
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">arrTest</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-keyword">var</span> arr1 [<span class="hljs-number">5</span>]<span class="hljs-keyword">int</span>
	printArrR(&amp;arr1)
	fmt.Println()
	fmt.Println(arr1)
&#125;
<span class="hljs-comment">// 输出</span>
<span class="hljs-number">0</span> <span class="hljs-number">100</span>
<span class="hljs-number">1</span> <span class="hljs-number">0</span>
<span class="hljs-number">2</span> <span class="hljs-number">0</span>
<span class="hljs-number">3</span> <span class="hljs-number">0</span>
<span class="hljs-number">4</span> <span class="hljs-number">0</span>

[<span class="hljs-number">100</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>]</code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/blob/master/go/collections/array.go">https://github.com/weitrue/note/blob/master/go/collections/array.go</a></p>
<h4 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h4><ul>
<li><p>slice可以向后扩展，但不能向前扩展</p>
</li>
<li><p>s[i]不可超越len(s)，向后扩展不可以超越底层数组cap(s)</p>
</li>
</ul>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">slice</span><span class="hljs-params">()</span></span> &#123;
	arr := [...]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>&#125;
	s1 := arr[<span class="hljs-number">2</span>: <span class="hljs-number">6</span>]
	fmt.Println(s1)
	s2 := s1[<span class="hljs-number">3</span>: <span class="hljs-number">5</span>]
	fmt.Println(s2)
  s3 := s1[<span class="hljs-number">3</span>:<span class="hljs-number">6</span>]
	fmt.Println(s3)
&#125;
<span class="hljs-comment">//输出</span>
[<span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span>]
[<span class="hljs-number">6</span> <span class="hljs-number">7</span>]
<span class="hljs-built_in">panic</span>: runtime error: slice bounds out of <span class="hljs-keyword">range</span> [:<span class="hljs-number">6</span>] with capacity <span class="hljs-number">5</span>

goroutine <span class="hljs-number">1</span> [running]:
main.sliceDefine()
        ~/Projects/golang/src/offer/note/slices.<span class="hljs-keyword">go</span>:<span class="hljs-number">20</span> +<span class="hljs-number">0x164</span>
main.main()
        ~/Projects/golang/src/offer/note/ab_test_func.<span class="hljs-keyword">go</span>:<span class="hljs-number">28</span> +<span class="hljs-number">0x20</span>
</code></pre>

<p><img src="/images/Golang/slice.png" srcset="/img/loading.gif"></p>
<ul>
<li><p>向slice添加元素，如果超越cap，系统会自动分配更大的底层数组</p>
</li>
<li><p>由于值传递的原因，必须接收append的返回值<code>s=append(s, val)</code></p>
</li>
</ul>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sliceAppend</span><span class="hljs-params">()</span></span> &#123;
	arr := [...]<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;
	s1 := arr[<span class="hljs-number">2</span>: <span class="hljs-number">6</span>]
	fmt.Println(s1, <span class="hljs-built_in">cap</span>(s1), <span class="hljs-built_in">len</span>(s1))
	s2 := s1[<span class="hljs-number">3</span>: <span class="hljs-number">5</span>]
	fmt.Println(s2)
	s3 := <span class="hljs-built_in">append</span>(s2, <span class="hljs-number">10</span>)
	s4 := <span class="hljs-built_in">append</span>(s3, <span class="hljs-number">11</span>)
	s5 := <span class="hljs-built_in">append</span>(s4, <span class="hljs-number">12</span>)
	fmt.Println(<span class="hljs-string">&quot;s3, s4, s5=&quot;</span>, s3, s4, s5)
	fmt.Println(arr)
  
  s6 := <span class="hljs-built_in">append</span>(s1, <span class="hljs-number">10</span>)
	s7 := <span class="hljs-built_in">append</span>(s6, <span class="hljs-number">11</span>)
	s8 := <span class="hljs-built_in">append</span>(s7, <span class="hljs-number">12</span>)
	fmt.Println(<span class="hljs-string">&quot;s6, s7, s8=&quot;</span>, s6, s7, s8)
	fmt.Println(<span class="hljs-string">&quot;cap(s6), cap(s7), cap(s8) =&quot;</span>, <span class="hljs-built_in">cap</span>(s6), <span class="hljs-built_in">cap</span>(s7), <span class="hljs-built_in">cap</span>(s8))
	fmt.Println(arr)
&#125;
<span class="hljs-comment">// 输出</span>
[<span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span>] <span class="hljs-number">6</span> <span class="hljs-number">4</span>
[<span class="hljs-number">6</span> <span class="hljs-number">7</span>]
s3, s4, s5= [<span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">10</span>] [<span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">10</span> <span class="hljs-number">11</span>] [<span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">10</span> <span class="hljs-number">11</span> <span class="hljs-number">12</span>]
<span class="hljs-built_in">cap</span>(s3), <span class="hljs-built_in">cap</span>(s4), <span class="hljs-built_in">cap</span>(s5) = <span class="hljs-number">3</span> <span class="hljs-number">6</span> <span class="hljs-number">6</span>
[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">10</span>]

s6, s7, s8= [<span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">10</span>] [<span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">10</span> <span class="hljs-number">11</span>] [<span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">10</span> <span class="hljs-number">11</span> <span class="hljs-number">12</span>]
<span class="hljs-built_in">cap</span>(s6), <span class="hljs-built_in">cap</span>(s7), <span class="hljs-built_in">cap</span>(s8) = <span class="hljs-number">6</span> <span class="hljs-number">6</span> <span class="hljs-number">12</span>
[<span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">10</span> <span class="hljs-number">11</span>]
</code></pre>

<ul>
<li>Zero value for slice is nil</li>
</ul>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sliceDefine</span><span class="hljs-params">()</span></span> &#123;
	<span class="hljs-keyword">var</span> s []<span class="hljs-keyword">int</span>
	<span class="hljs-keyword">for</span> i :=<span class="hljs-number">0</span>; i &lt;<span class="hljs-number">10</span>; i++ &#123;
		fmt.Printf(<span class="hljs-string">&quot;%v, cap(s) = %d, len(s) = %d\n&quot;</span>, s, <span class="hljs-built_in">cap</span>(s), <span class="hljs-built_in">len</span>(s))
		s = <span class="hljs-built_in">append</span>(s, <span class="hljs-number">2</span>*i + <span class="hljs-number">1</span>)
	&#125;

	s1 := []<span class="hljs-keyword">int</span>&#123;<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;
	fmt.Printf(<span class="hljs-string">&quot;%v, cap(s1) = %d, len(s1) = %d\n&quot;</span>, s1, <span class="hljs-built_in">cap</span>(s1), <span class="hljs-built_in">len</span>(s1))

	s2 := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, <span class="hljs-number">8</span>)
	fmt.Printf(<span class="hljs-string">&quot;%v, cap(s2) = %d, len(s2) = %d\n&quot;</span>, s2, <span class="hljs-built_in">cap</span>(s2), <span class="hljs-built_in">len</span>(s2))

	s3 := <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">int</span>, <span class="hljs-number">8</span>, <span class="hljs-number">32</span>)
	fmt.Printf(<span class="hljs-string">&quot;%v, cap(s3) = %d, len(s3) = %d\n&quot;</span>, s3, <span class="hljs-built_in">cap</span>(s3), <span class="hljs-built_in">len</span>(s3))

	<span class="hljs-comment">// 拷贝</span>
	<span class="hljs-built_in">copy</span>(s2, s1)
	fmt.Printf(<span class="hljs-string">&quot;%v, cap(s2) = %d, len(s2) = %d\n&quot;</span>, s2, <span class="hljs-built_in">cap</span>(s2), <span class="hljs-built_in">len</span>(s2))

	<span class="hljs-comment">// 删除 没有内建函数，只能通过截取+append</span>
	s4 := <span class="hljs-built_in">append</span>(s2[:<span class="hljs-number">2</span>], s2[<span class="hljs-number">3</span>:]...)
	fmt.Printf(<span class="hljs-string">&quot;%v, cap(s4) = %d, len(s4) = %d\n&quot;</span>, s4, <span class="hljs-built_in">cap</span>(s4), <span class="hljs-built_in">len</span>(s4))
&#125;

<span class="hljs-comment">//输出</span>
[], <span class="hljs-built_in">cap</span>(s) = <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(s) = <span class="hljs-number">0</span>
[<span class="hljs-number">1</span>], <span class="hljs-built_in">cap</span>(s) = <span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(s) = <span class="hljs-number">1</span>
[<span class="hljs-number">1</span> <span class="hljs-number">3</span>], <span class="hljs-built_in">cap</span>(s) = <span class="hljs-number">2</span>, <span class="hljs-built_in">len</span>(s) = <span class="hljs-number">2</span>
[<span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span>], <span class="hljs-built_in">cap</span>(s) = <span class="hljs-number">4</span>, <span class="hljs-built_in">len</span>(s) = <span class="hljs-number">3</span>
[<span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span> <span class="hljs-number">7</span>], <span class="hljs-built_in">cap</span>(s) = <span class="hljs-number">4</span>, <span class="hljs-built_in">len</span>(s) = <span class="hljs-number">4</span>
[<span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span> <span class="hljs-number">7</span> <span class="hljs-number">9</span>], <span class="hljs-built_in">cap</span>(s) = <span class="hljs-number">8</span>, <span class="hljs-built_in">len</span>(s) = <span class="hljs-number">5</span>
[<span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span> <span class="hljs-number">7</span> <span class="hljs-number">9</span> <span class="hljs-number">11</span>], <span class="hljs-built_in">cap</span>(s) = <span class="hljs-number">8</span>, <span class="hljs-built_in">len</span>(s) = <span class="hljs-number">6</span>
[<span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span> <span class="hljs-number">7</span> <span class="hljs-number">9</span> <span class="hljs-number">11</span> <span class="hljs-number">13</span>], <span class="hljs-built_in">cap</span>(s) = <span class="hljs-number">8</span>, <span class="hljs-built_in">len</span>(s) = <span class="hljs-number">7</span>
[<span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span> <span class="hljs-number">7</span> <span class="hljs-number">9</span> <span class="hljs-number">11</span> <span class="hljs-number">13</span> <span class="hljs-number">15</span>], <span class="hljs-built_in">cap</span>(s) = <span class="hljs-number">8</span>, <span class="hljs-built_in">len</span>(s) = <span class="hljs-number">8</span>
[<span class="hljs-number">1</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span> <span class="hljs-number">7</span> <span class="hljs-number">9</span> <span class="hljs-number">11</span> <span class="hljs-number">13</span> <span class="hljs-number">15</span> <span class="hljs-number">17</span>], <span class="hljs-built_in">cap</span>(s) = <span class="hljs-number">16</span>, <span class="hljs-built_in">len</span>(s) = <span class="hljs-number">9</span>
[<span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span>], <span class="hljs-built_in">cap</span>(s1) = <span class="hljs-number">3</span>, <span class="hljs-built_in">len</span>(s1) = <span class="hljs-number">3</span>
[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>], <span class="hljs-built_in">cap</span>(s2) = <span class="hljs-number">8</span>, <span class="hljs-built_in">len</span>(s2) = <span class="hljs-number">8</span>
[<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>], <span class="hljs-built_in">cap</span>(s3) = <span class="hljs-number">32</span>, <span class="hljs-built_in">len</span>(s3) = <span class="hljs-number">8</span>
[<span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>], <span class="hljs-built_in">cap</span>(s2) = <span class="hljs-number">8</span>, <span class="hljs-built_in">len</span>(s2) = <span class="hljs-number">8</span>
[<span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>], <span class="hljs-built_in">cap</span>(s4) = <span class="hljs-number">8</span>, <span class="hljs-built_in">len</span>(s4) = <span class="hljs-number">7</span></code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/blob/master/go/collections/slices.go">https://github.com/weitrue/note/blob/master/go/collections/slices.go</a></p>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><ul>
<li><p>创建<code>make(map[type]type)</code></p>
</li>
<li><p>key不存在时，获取value类型的初始值，需要<code>if value, ok := m[key]; ok &#123;...&#125;</code> 判断是否存在key</p>
</li>
<li><p>map使用哈希表，必须可以比较相等</p>
</li>
<li><p>除了slice, map,function的内建类型都可以作为map的key,Struct类型不包含上述字段时，也可作为key</p>
</li>
</ul>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">mapDefine</span><span class="hljs-params">()</span></span>  &#123;
	m := <span class="hljs-keyword">map</span>[<span class="hljs-keyword">int</span>]<span class="hljs-keyword">string</span>&#123;
		<span class="hljs-number">1</span>: <span class="hljs-string">&quot;aa&quot;</span>,
		<span class="hljs-number">2</span>: <span class="hljs-string">&quot;bb&quot;</span>,
	&#125;
	<span class="hljs-keyword">if</span> v, ok := m[<span class="hljs-number">3</span>]; ok &#123;
		fmt.Println(v)
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;key not exists&quot;</span>)
	&#125;
&#125;

<span class="hljs-comment">//输出</span>
<span class="hljs-built_in">panic</span>: key not exists

goroutine <span class="hljs-number">1</span> [running]:
main.mapDefine()
        /Users/wangpeng/Projects/golang/src/offer/note/maps.<span class="hljs-keyword">go</span>:<span class="hljs-number">20</span> +<span class="hljs-number">0x1f6</span>
main.main()
        /Users/wangpeng/Projects/golang/src/offer/note/ab_test_func.<span class="hljs-keyword">go</span>:<span class="hljs-number">32</span> +<span class="hljs-number">0x20</span></code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/blob/master/go/collections/maps.go">https://github.com/weitrue/note/blob/master/go/collections/maps.go</a></p>
<h4 id="Rune"><a href="#Rune" class="headerlink" title="Rune"></a>Rune</h4><p>字符串在UTF-8编码中，一个中文占三个字节，</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">strByte</span><span class="hljs-params">(s <span class="hljs-keyword">string</span>)</span></span>  &#123;
	<span class="hljs-keyword">if</span> s == <span class="hljs-string">&quot;&quot;</span> &#123;
		s = <span class="hljs-string">&quot;yes,我喜欢你！&quot;</span>
	&#125;
	<span class="hljs-keyword">for</span> i, ch := <span class="hljs-keyword">range</span> []<span class="hljs-keyword">byte</span>(s) &#123;
		fmt.Printf(<span class="hljs-string">&quot;(%d, %X)&quot;</span>, i, ch)
	&#125;
	fmt.Println()
  <span class="hljs-keyword">for</span> i, ch := <span class="hljs-keyword">range</span> s &#123; <span class="hljs-comment">// ch is a rune 其实是将s进行utf-8解码，解码后的字符会转成unicode,然后放入rune中</span>
		fmt.Printf(<span class="hljs-string">&quot;(%d, %X)&quot;</span>, i, ch)
	&#125;
	fmt.Println()
  bytes := []<span class="hljs-keyword">byte</span>(s)
	<span class="hljs-keyword">for</span> <span class="hljs-built_in">len</span>(bytes) &gt;<span class="hljs-number">0</span> &#123;
		ch, size := utf8.DecodeRune(bytes)
		bytes = bytes[size:]
		fmt.Printf(<span class="hljs-string">&quot;%c &quot;</span>, ch)
	&#125;
	fmt.Println()
	<span class="hljs-keyword">for</span> i, ch := <span class="hljs-keyword">range</span> []<span class="hljs-keyword">rune</span>(s) &#123;
		fmt.Printf(<span class="hljs-string">&quot;(%d, %X)&quot;</span>, i, ch)
	&#125;
&#125;

<span class="hljs-comment">// 输出</span>
(<span class="hljs-number">0</span>, <span class="hljs-number">79</span>)(<span class="hljs-number">1</span>, <span class="hljs-number">65</span>)(<span class="hljs-number">2</span>, <span class="hljs-number">73</span>)(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>C)(<span class="hljs-number">4</span>, E6)(<span class="hljs-number">5</span>, <span class="hljs-number">88</span>)(<span class="hljs-number">6</span>, <span class="hljs-number">91</span>)(<span class="hljs-number">7</span>, E5)(<span class="hljs-number">8</span>, <span class="hljs-number">96</span>)(<span class="hljs-number">9</span>, <span class="hljs-number">9</span>C)(<span class="hljs-number">10</span>, E6)(<span class="hljs-number">11</span>, AC)(<span class="hljs-number">12</span>, A2)(<span class="hljs-number">13</span>, E4)(<span class="hljs-number">14</span>, BD)(<span class="hljs-number">15</span>, A0)(<span class="hljs-number">16</span>, EF)(<span class="hljs-number">17</span>, BC)(<span class="hljs-number">18</span>, <span class="hljs-number">81</span>)
(<span class="hljs-number">0</span>, <span class="hljs-number">79</span>)(<span class="hljs-number">1</span>, <span class="hljs-number">65</span>)(<span class="hljs-number">2</span>, <span class="hljs-number">73</span>)(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>C)(<span class="hljs-number">4</span>, <span class="hljs-number">6211</span>)(<span class="hljs-number">7</span>, <span class="hljs-number">559</span>C)(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>B22)(<span class="hljs-number">13</span>, <span class="hljs-number">4</span>F60)(<span class="hljs-number">16</span>, FF01)
y e s , 我 喜 欢 你 ！
(<span class="hljs-number">0</span>, <span class="hljs-number">79</span>)(<span class="hljs-number">1</span>, <span class="hljs-number">65</span>)(<span class="hljs-number">2</span>, <span class="hljs-number">73</span>)(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>C)(<span class="hljs-number">4</span>, <span class="hljs-number">6211</span>)(<span class="hljs-number">5</span>, <span class="hljs-number">559</span>C)(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>B22)(<span class="hljs-number">7</span>, <span class="hljs-number">4</span>F60)(<span class="hljs-number">8</span>, FF01)
</code></pre>

<p>因此在需要使用rune</p>
<pre><code class="hljs go"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Version: 1.0.0</span>
<span class="hljs-comment"> * Description: 获取字符串中不重复字串最大长度</span>
<span class="hljs-comment"> **/</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">maxNoRepeated</span><span class="hljs-params">(s <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">int</span></span> &#123;
  <span class="hljs-comment">// 仅支持英文字符</span>
	<span class="hljs-comment">// 字符下标映射</span>
  chNotRepeatIndex := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">byte</span>] <span class="hljs-keyword">int</span>)
	<span class="hljs-comment">// 最长串起始位置</span>
  start := <span class="hljs-number">0</span>
  <span class="hljs-comment">// 最长串长度</span>
	maxLength := <span class="hljs-number">0</span>
	 <span class="hljs-keyword">for</span> i, ch := <span class="hljs-keyword">range</span> []<span class="hljs-keyword">byte</span>(s) &#123;
	 	<span class="hljs-keyword">if</span> lastI, ok := chNotRepeatIndex[ch]; ok &amp;&amp; lastI &gt;= start &#123;
	 		start = lastI + <span class="hljs-number">1</span>
		&#125;
		<span class="hljs-keyword">if</span> i - start + <span class="hljs-number">1</span> &gt; maxLength &#123;
			maxLength = i - start + <span class="hljs-number">1</span>
		&#125;
		chNotRepeatIndex[ch] = i
	 &#125;
	 <span class="hljs-keyword">return</span> maxLength
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">maxNoRepeatedChn</span><span class="hljs-params">(s <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">int</span></span> &#123;
  <span class="hljs-comment">// 通过rune</span>
	chNotRepeatIndex := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">rune</span>] <span class="hljs-keyword">int</span>)
	start := <span class="hljs-number">0</span>
	maxLength := <span class="hljs-number">0</span>
	<span class="hljs-keyword">for</span> i, ch := <span class="hljs-keyword">range</span> []<span class="hljs-keyword">rune</span>(s) &#123;
		<span class="hljs-keyword">if</span> lastI, ok := chNotRepeatIndex[ch]; ok &amp;&amp; lastI &gt;= start &#123;
			start = lastI + <span class="hljs-number">1</span>
		&#125;
		<span class="hljs-keyword">if</span> i - start + <span class="hljs-number">1</span> &gt; maxLength &#123;
			maxLength = i - start + <span class="hljs-number">1</span>
		&#125;
		chNotRepeatIndex[ch] = i
	&#125;
	<span class="hljs-keyword">return</span> maxLength
&#125;</code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/blob/master/go/collections/strings.go">https://github.com/weitrue/note/blob/master/go/collections/strings.go</a></p>
<h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><p>仅<em>支持封装</em>，不支持继承和多态</p>
<pre><code class="hljs go"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span>

<span class="hljs-keyword">type</span> Node <span class="hljs-keyword">struct</span> &#123;
	Value       <span class="hljs-keyword">int</span>
	Left, Right *Node
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(node Node)</span> <span class="hljs-title">Print</span><span class="hljs-params">()</span></span> &#123;
	fmt.Print(node.Value, <span class="hljs-string">&quot; &quot;</span>)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(node *Node)</span> <span class="hljs-title">SetValue</span><span class="hljs-params">(value <span class="hljs-keyword">int</span>)</span></span> &#123;
  <span class="hljs-comment">// 接收者使用指针才可以改变结构内容</span>
	<span class="hljs-keyword">if</span> node == <span class="hljs-literal">nil</span> &#123;
		fmt.Println(<span class="hljs-string">&quot;Setting Value to nil node. Ignored.&quot;</span>)
		<span class="hljs-keyword">return</span>
	&#125;
	node.Value = value
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(node Node)</span> <span class="hljs-title">SetValueNotUpdate</span><span class="hljs-params">(value <span class="hljs-keyword">int</span>)</span></span> &#123;
  <span class="hljs-comment">// 值传递 node内容无法改变</span>
	<span class="hljs-keyword">if</span> &amp;node == <span class="hljs-literal">nil</span> &#123;
		fmt.Println(<span class="hljs-string">&quot;Setting Value to nil node. Ignored.&quot;</span>)
		<span class="hljs-keyword">return</span>
	&#125;
	node.Value = value
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CreateNode</span><span class="hljs-params">(value <span class="hljs-keyword">int</span>)</span> *<span class="hljs-title">Node</span></span> &#123;
  <span class="hljs-comment">// 返回局部变量地址，这样变量会在堆中声明，可以传到外部</span>
	<span class="hljs-keyword">return</span> &amp;Node&#123;Value: value&#125;
&#125;</code></pre>

<p>方法有接收者（值/指针接收者），需要改变内容必须使用指针接收者，结构体过大考虑用指针接收者</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
  node := Node&#123;&#125;
	node.Print()
	node.SetValueNotUpdate(<span class="hljs-number">10</span>)
	node.Print()
	node.SetValue(<span class="hljs-number">10</span>)
	node.Print()
&#125;

<span class="hljs-comment">// 输出</span>
<span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10</span></code></pre>

<p>nil也可以调用方法</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
  <span class="hljs-keyword">var</span> pNode *Node
	pNode.SetValue(<span class="hljs-number">30</span>)
&#125;

<span class="hljs-comment">// 输出</span>
Setting Value to <span class="hljs-literal">nil</span> node. Ignored.</code></pre>

<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
  <span class="hljs-keyword">var</span> pNode *Node
	pNode.SetValueNotUpdate(<span class="hljs-number">20</span>)
&#125;

<span class="hljs-comment">// 输出</span>
<span class="hljs-built_in">panic</span>: runtime error: invalid memory address or <span class="hljs-literal">nil</span> pointer dereference
[signal SIGSEGV: segmentation violation code=<span class="hljs-number">0x1</span> addr=<span class="hljs-number">0x0</span> pc=<span class="hljs-number">0x109d0af</span>]

goroutine <span class="hljs-number">1</span> [running]:
main.main()
        ～/Projects/golang/src/offer/note/ab_test_func.<span class="hljs-keyword">go</span>:<span class="hljs-number">50</span> +<span class="hljs-number">0x1f</span>
</code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/blob/master/go/object/tree.go">https://github.com/weitrue/note/blob/master/go/object/tree.go</a></p>
<h4 id="封装与包"><a href="#封装与包" class="headerlink" title="封装与包"></a>封装与包</h4><p>首字母大写:public，首字母小写:private</p>
<p>为结构体定义的方法需要放在一个包下（可以是不同的文件）</p>
<p>扩充系统类型或者自定义类型方式：定义别名和使用组合</p>
<pre><code class="hljs go"><span class="hljs-keyword">type</span> Queue []<span class="hljs-keyword">int</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span><span class="hljs-title">Push</span><span class="hljs-params">(val <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">error</span></span> &#123;
	*q = <span class="hljs-built_in">append</span>(*q, val)
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span><span class="hljs-title">Pop</span><span class="hljs-params">()</span> <span class="hljs-params">(<span class="hljs-keyword">int</span>,<span class="hljs-keyword">bool</span>)</span></span> &#123;
	<span class="hljs-keyword">if</span> q.IsEmpty() &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>
	&#125;
	head := (*q)[<span class="hljs-number">0</span>]
	*q = (*q)[<span class="hljs-number">1</span>:]
	<span class="hljs-keyword">return</span> head, <span class="hljs-literal">true</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span><span class="hljs-title">IsEmpty</span><span class="hljs-params">()</span> <span class="hljs-title">bool</span></span> &#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(*q) == <span class="hljs-number">0</span>
&#125;</code></pre>

<pre><code class="hljs go"><span class="hljs-keyword">type</span> Node <span class="hljs-keyword">struct</span> &#123;
	Value       <span class="hljs-keyword">int</span>
	Left, Right *Node
&#125;

<span class="hljs-keyword">type</span> MyNode <span class="hljs-keyword">struct</span> &#123;
	node *Node
&#125;</code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/blob/master/go/object/queue.go">https://github.com/weitrue/note/blob/master/go/object/queue.go</a></p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><h4 id="鸭子类型"><a href="#鸭子类型" class="headerlink" title="鸭子类型"></a>鸭子类型</h4><p>接口由使用者定义</p>
<p>​    Python的在运行时才能知道被调用的对象是否实现某个方法</p>
<p>​    Java中编译前，调用的对象就必须实现接口所有方法</p>
<p>接口变量自带指针（参数传递也是值传递），因此几乎不需要使用接口指针    </p>
<p><img src="/images/Golang/interface.png" srcset="/img/loading.gif"></p>
<pre><code class="hljs go"><span class="hljs-comment">// offer/note/interfaces/mock/duck.go</span>
<span class="hljs-keyword">package</span> mock

<span class="hljs-keyword">type</span> Duck <span class="hljs-keyword">struct</span> &#123;
	Name <span class="hljs-keyword">string</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *Duck)</span> <span class="hljs-title">GetName</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;
  <span class="hljs-comment">// 实现者没有指明实现了哪个接口</span>
	<span class="hljs-keyword">if</span> d.Name != <span class="hljs-string">&quot;&quot;</span> &#123;
		<span class="hljs-keyword">return</span> d.Name
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;这是一个鸭子！&quot;</span>
	&#125;
&#125;

<span class="hljs-comment">// offer/note/interfaces/duckI.go</span>
<span class="hljs-keyword">package</span> interfaces

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span>

<span class="hljs-keyword">type</span> DuckI <span class="hljs-keyword">interface</span> &#123;
  <span class="hljs-comment">// 使用接口者 定义方法</span>
	GetName() <span class="hljs-keyword">string</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">FindDuck</span><span class="hljs-params">(d DuckI)</span></span>  &#123; <span class="hljs-comment">// 接口变量自带指针</span>
	name := d.GetName()
	fmt.Println(name)
&#125;

<span class="hljs-comment">// offer/note/main.go</span>
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;offer/note/interfaces&quot;</span>
	<span class="hljs-string">&quot;offer/note/interfaces/mock&quot;</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
  interfaces.FindDuck(&amp;mock.Duck&#123;&#125;)
  interfaces.FindDuck(&amp;mock.Duck&#123;Name:<span class="hljs-string">&quot;这是一只假鸭子&quot;</span>&#125;)
&#125;


<span class="hljs-comment">// 输出</span>
这是一个鸭子！
这是一只假鸭子</code></pre>

<h4 id="任何类型"><a href="#任何类型" class="headerlink" title="任何类型"></a>任何类型</h4><p><code>interface&#123;&#125;</code></p>
<pre><code class="hljs go"><span class="hljs-keyword">type</span> Queue []<span class="hljs-keyword">interface</span>&#123;&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span><span class="hljs-title">Push</span><span class="hljs-params">(val <span class="hljs-keyword">interface</span>&#123;&#125;)</span> <span class="hljs-title">error</span></span> &#123;
	*q = <span class="hljs-built_in">append</span>(*q, val)
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span><span class="hljs-title">Pop</span><span class="hljs-params">()</span> <span class="hljs-params">(<span class="hljs-keyword">interface</span>&#123;&#125;,<span class="hljs-keyword">bool</span>)</span></span> &#123;
	<span class="hljs-keyword">if</span> q.IsEmpty() &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, <span class="hljs-literal">false</span>
	&#125;
	head := (*q)[<span class="hljs-number">0</span>]
	*q = (*q)[<span class="hljs-number">1</span>:]
	<span class="hljs-keyword">return</span> head, <span class="hljs-literal">true</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(q *Queue)</span><span class="hljs-title">IsEmpty</span><span class="hljs-params">()</span> <span class="hljs-title">bool</span></span> &#123;
	<span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(*q) == <span class="hljs-number">0</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;
  q := interfaces.Queue&#123;&#125;
	_ = q.Push(<span class="hljs-string">&quot;asd&quot;</span>)
	_ = q.Push(<span class="hljs-number">123</span>)
	<span class="hljs-keyword">if</span> v, ok := q.Pop(); ok &#123;
		fmt.Println(v)
	&#125;
	<span class="hljs-keyword">if</span> v, ok := q.Pop(); ok &#123;
		fmt.Println(v)
	&#125;
&#125;

<span class="hljs-comment">// 输出</span>
asd
<span class="hljs-number">123</span></code></pre>

<h4 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h4><pre><code class="hljs go"><span class="hljs-comment">// offer/note/interfaces/animals.go</span>
<span class="hljs-keyword">package</span> animal

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span>

<span class="hljs-keyword">type</span> AnimalsI <span class="hljs-keyword">interface</span> &#123;
	DuckI
	BehaviorI
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DuckBehavior</span><span class="hljs-params">(a AnimalsI)</span></span>  &#123;
	name := a.GetName()
	dark := a.Shout(<span class="hljs-string">&quot;呱呱乱叫&quot;</span>)
	fmt.Println(name, dark)
  fmt.Println(a.String())
&#125;


<span class="hljs-comment">// offer/note/interfaces/behaviorI.go</span>
<span class="hljs-keyword">package</span> animal

<span class="hljs-keyword">type</span> BehaviorI <span class="hljs-keyword">interface</span> &#123;
	Shout(dark <span class="hljs-keyword">string</span>) <span class="hljs-keyword">string</span>
&#125;


<span class="hljs-comment">// offer/note/interfaces/duckI.go</span>
<span class="hljs-keyword">package</span> animal

<span class="hljs-keyword">type</span> DuckI <span class="hljs-keyword">interface</span> &#123;
	GetName() <span class="hljs-keyword">string</span>
&#125;


<span class="hljs-comment">// offer/note/interfaces/mock/duck.go</span>
<span class="hljs-keyword">package</span> mock

<span class="hljs-keyword">type</span> Duck <span class="hljs-keyword">struct</span> &#123;
	name <span class="hljs-keyword">string</span>
	bark <span class="hljs-keyword">string</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *Duck)</span> <span class="hljs-title">GetName</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;
	<span class="hljs-keyword">if</span> d.name != <span class="hljs-string">&quot;&quot;</span> &#123;
		<span class="hljs-keyword">return</span> d.name
	&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;这是一个鸭子&quot;</span>
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *Duck)</span> <span class="hljs-title">Shout</span><span class="hljs-params">(dark <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">string</span></span> &#123;
	<span class="hljs-keyword">if</span> d.bark == <span class="hljs-string">&quot;&quot;</span>&#123;
		<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;呱呱呱呱的叫&quot;</span>
	&#125;<span class="hljs-keyword">else</span> &#123;
		<span class="hljs-keyword">return</span> dark
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *Duck)</span> <span class="hljs-title">String</span><span class="hljs-params">()</span> <span class="hljs-title">string</span></span> &#123;
	<span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">&quot;Duck: &#123; name = %s, bark = %s &#125;&quot;</span>, d.name, d.bark)
&#125;

<span class="hljs-comment">// 输出</span>
这是一个鸭子 呱呱呱呱的叫
Duck: &#123; name = , bark =  &#125;</code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/tree/master/go/interfaces">https://github.com/weitrue/note/tree/master/go/interfaces</a></p>
<h4 id="常用接口"><a href="#常用接口" class="headerlink" title="常用接口"></a>常用接口</h4><ul>
<li><code>Stringer</code>相当于toString()</li>
</ul>
<pre><code class="hljs go"><span class="hljs-keyword">type</span> Stringer <span class="hljs-keyword">interface</span> &#123;
	String() <span class="hljs-keyword">string</span>
&#125;</code></pre>

<ul>
<li><code>Reader</code></li>
<li><code>Writer</code></li>
</ul>
<pre><code class="hljs go"><span class="hljs-comment">// io/io.go</span>

<span class="hljs-comment">// Reader is the interface that wraps the basic Read method.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Read reads up to len(p) bytes into p. It returns the number of bytes</span>
<span class="hljs-comment">// read (0 &lt;= n &lt;= len(p)) and any error encountered. Even if Read</span>
<span class="hljs-comment">// returns n &lt; len(p), it may use all of p as scratch space during the call.</span>
<span class="hljs-comment">// If some data is available but not len(p) bytes, Read conventionally</span>
<span class="hljs-comment">// returns what is available instead of waiting for more.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// When Read encounters an error or end-of-file condition after</span>
<span class="hljs-comment">// successfully reading n &gt; 0 bytes, it returns the number of</span>
<span class="hljs-comment">// bytes read. It may return the (non-nil) error from the same call</span>
<span class="hljs-comment">// or return the error (and n == 0) from a subsequent call.</span>
<span class="hljs-comment">// An instance of this general case is that a Reader returning</span>
<span class="hljs-comment">// a non-zero number of bytes at the end of the input stream may</span>
<span class="hljs-comment">// return either err == EOF or err == nil. The next Read should</span>
<span class="hljs-comment">// return 0, EOF.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Callers should always process the n &gt; 0 bytes returned before</span>
<span class="hljs-comment">// considering the error err. Doing so correctly handles I/O errors</span>
<span class="hljs-comment">// that happen after reading some bytes and also both of the</span>
<span class="hljs-comment">// allowed EOF behaviors.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Implementations of Read are discouraged from returning a</span>
<span class="hljs-comment">// zero byte count with a nil error, except when len(p) == 0.</span>
<span class="hljs-comment">// Callers should treat a return of 0 and nil as indicating that</span>
<span class="hljs-comment">// nothing happened; in particular it does not indicate EOF.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Implementations must not retain p.</span>
<span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">interface</span> &#123;
	Read(p []<span class="hljs-keyword">byte</span>) (n <span class="hljs-keyword">int</span>, err error)
&#125;

<span class="hljs-comment">// Writer is the interface that wraps the basic Write method.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Write writes len(p) bytes from p to the underlying data stream.</span>
<span class="hljs-comment">// It returns the number of bytes written from p (0 &lt;= n &lt;= len(p))</span>
<span class="hljs-comment">// and any error encountered that caused the write to stop early.</span>
<span class="hljs-comment">// Write must return a non-nil error if it returns n &lt; len(p).</span>
<span class="hljs-comment">// Write must not modify the slice data, even temporarily.</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Implementations must not retain p.</span>
<span class="hljs-keyword">type</span> Writer <span class="hljs-keyword">interface</span> &#123;
	Write(p []<span class="hljs-keyword">byte</span>) (n <span class="hljs-keyword">int</span>, err error)
&#125;

<span class="hljs-comment">// ReadWriter is the interface that groups the basic Read and Write methods.</span>
<span class="hljs-keyword">type</span> ReadWriter <span class="hljs-keyword">interface</span> &#123;
	Reader
	Writer
&#125;</code></pre>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul>
<li>函数可以有多个返回值，并且这些返回值可以起别名（别名多用于简单函数），别名与调用者的申明变量并无关联</li>
</ul>
<pre><code class="hljs go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">eval</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>, op <span class="hljs-keyword">string</span>)</span> <span class="hljs-params">(<span class="hljs-keyword">int</span>, error)</span></span> &#123;
	<span class="hljs-keyword">switch</span> op &#123;
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;+&quot;</span>:
		<span class="hljs-keyword">return</span>  a + b, <span class="hljs-literal">nil</span>
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;-&quot;</span>:
		<span class="hljs-keyword">return</span> a - b, <span class="hljs-literal">nil</span>
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;*&quot;</span>:
		<span class="hljs-keyword">return</span> a * b, <span class="hljs-literal">nil</span>
	<span class="hljs-keyword">case</span> <span class="hljs-string">&quot;/&quot;</span>:
		r, _ := div(a, b)
		<span class="hljs-keyword">return</span> r, <span class="hljs-literal">nil</span>
	<span class="hljs-keyword">default</span>:
		<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>, fmt.Errorf(<span class="hljs-string">&quot;unsupported operation&quot;</span>)
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">div</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-params">(q, r <span class="hljs-keyword">int</span>)</span></span> &#123;
	<span class="hljs-keyword">return</span> a/b, a%b
&#125;</code></pre>

<ul>
<li><em>一等公民</em> :变量、参数、返回值均可以是函数</li>
</ul>
<pre><code class="hljs go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;fmt&quot;</span>
	<span class="hljs-string">&quot;math&quot;</span>
	<span class="hljs-string">&quot;reflect&quot;</span>
	<span class="hljs-string">&quot;runtime&quot;</span>
)
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">apply</span><span class="hljs-params">(op <span class="hljs-keyword">func</span>(<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">float64</span>, <span class="hljs-title">a</span>, <span class="hljs-title">b</span> <span class="hljs-title">int</span>) <span class="hljs-title">float64</span></span> &#123;
	<span class="hljs-comment">//</span>
	p := reflect.ValueOf(op).Pointer()
	opName := runtime.FuncForPC(p).Name()
	fmt.Printf(<span class="hljs-string">&quot;Calling function %s with params (%d, %d)\n&quot;</span>, opName, a, b)
	<span class="hljs-keyword">return</span> op(<span class="hljs-keyword">int</span>(a), <span class="hljs-keyword">int</span>(b))
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pow</span><span class="hljs-params">(a, b <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">float64</span></span> &#123;
	<span class="hljs-keyword">return</span> math.Pow(<span class="hljs-keyword">float64</span>(a), <span class="hljs-keyword">float64</span>(b))
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;
	fmt.Println(apply(pow, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>))

	<span class="hljs-comment">// 匿名函数方式</span>
	fmt.Println(apply(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(f, f2 <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">float64</span></span> &#123;
		<span class="hljs-keyword">return</span> math.Pow(<span class="hljs-keyword">float64</span>(f), <span class="hljs-keyword">float64</span>(f2))
	&#125;, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>))
&#125;

<span class="hljs-comment">// 打印结果</span>
Calling function main.pow with params (<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
<span class="hljs-number">81</span>
Calling function main.main.func1 with params (<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)
<span class="hljs-number">81</span></code></pre>

<ul>
<li>可变参数列表，类似于Python中的*args</li>
</ul>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sum</span><span class="hljs-params">(nums ...<span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;
	<span class="hljs-comment">// 函数可变参数列表</span>
	sum := <span class="hljs-number">0</span>
	<span class="hljs-keyword">for</span> i := <span class="hljs-keyword">range</span> nums &#123;
		sum += nums[i]
	&#125;
	<span class="hljs-keyword">return</span> sum
&#125;</code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/blob/master/go/functions/func.go">https://github.com/weitrue/note/blob/master/go/functions/func.go</a></p>
<h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p><img src="/images/Golang/func.png" srcset="/img/loading.gif"></p>
<p>其中，<code>func(i int)</code>中<code>i</code>为局部变量，<code>sum</code>为自由变量</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">adder</span><span class="hljs-params">()</span> <span class="hljs-title">func</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;
	sum := <span class="hljs-number">0</span>
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(i <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">int</span></span> &#123;
		sum += i
		<span class="hljs-keyword">return</span> sum
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestAdder</span><span class="hljs-params">()</span></span>  &#123;
	a := adder()
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span> ; i++ &#123;
		fmt.Printf(<span class="hljs-string">&quot;0 + ... + %d = %d \n&quot;</span>, i, a(i))
	&#125;
&#125;

<span class="hljs-comment">// 输出</span>
<span class="hljs-number">0</span> + ... + <span class="hljs-number">0</span> = <span class="hljs-number">0</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">1</span> = <span class="hljs-number">1</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">2</span> = <span class="hljs-number">3</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">3</span> = <span class="hljs-number">6</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">4</span> = <span class="hljs-number">10</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">5</span> = <span class="hljs-number">15</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">6</span> = <span class="hljs-number">21</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">7</span> = <span class="hljs-number">28</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">8</span> = <span class="hljs-number">36</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">9</span> = <span class="hljs-number">45</span> 


<span class="hljs-comment">// 正统函数式编程</span>
<span class="hljs-keyword">type</span> iAdder <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-keyword">int</span>)</span> <span class="hljs-params">(<span class="hljs-keyword">int</span>, iAdder)</span></span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">iAdd</span><span class="hljs-params">(base <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">iAdder</span></span> &#123;
	<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(v <span class="hljs-keyword">int</span>)</span> <span class="hljs-params">(<span class="hljs-keyword">int</span>, iAdder)</span></span> &#123;
		<span class="hljs-keyword">return</span> base +v, iAdd(base+v)
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestAdder</span><span class="hljs-params">()</span></span> &#123;
	a2 := iAdd(<span class="hljs-number">0</span>)
	<span class="hljs-keyword">var</span> s <span class="hljs-keyword">int</span>
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;<span class="hljs-number">10</span>; i++ &#123;
		s, a2 = a2(i)
		fmt.Printf(<span class="hljs-string">&quot;0 + ... + %d = %d \n&quot;</span>, i, s)
	&#125;
&#125;

<span class="hljs-comment">// 输出</span>
<span class="hljs-number">0</span> + ... + <span class="hljs-number">1</span> = <span class="hljs-number">1</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">2</span> = <span class="hljs-number">3</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">3</span> = <span class="hljs-number">6</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">4</span> = <span class="hljs-number">10</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">5</span> = <span class="hljs-number">15</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">6</span> = <span class="hljs-number">21</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">7</span> = <span class="hljs-number">28</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">8</span> = <span class="hljs-number">36</span> 
<span class="hljs-number">0</span> + ... + <span class="hljs-number">9</span> = <span class="hljs-number">45</span></code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/blob/master/go/functions/closure.go">https://github.com/weitrue/note/blob/master/go/functions/closure.go</a></p>
<h5 id="Python中的闭包"><a href="#Python中的闭包" class="headerlink" title="Python中的闭包"></a>Python中的闭包</h5><p>Python原生支持闭包</p>
<p><code>__closure__</code>可以查看闭包内容</p>
<pre><code class="hljs Python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">adder</span>():</span>
    s = <span class="hljs-number">0</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>(<span class="hljs-params">v: <span class="hljs-built_in">int</span></span>):</span>
        <span class="hljs-keyword">nonlocal</span> s
        s += v
        <span class="hljs-keyword">return</span> s

    <span class="hljs-keyword">return</span> f


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:

    a = adder()
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
        print(i, a(i), a.__closure__)
        
<span class="hljs-comment"># 输出</span>
<span class="hljs-number">0</span> <span class="hljs-number">0</span> (&lt;cell at <span class="hljs-number">0x7f9048e7d3d0</span>: <span class="hljs-built_in">int</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x106eb6290</span>&gt;,)
<span class="hljs-number">1</span> <span class="hljs-number">1</span> (&lt;cell at <span class="hljs-number">0x7f9048e7d3d0</span>: <span class="hljs-built_in">int</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x106eb62b0</span>&gt;,)
<span class="hljs-number">2</span> <span class="hljs-number">3</span> (&lt;cell at <span class="hljs-number">0x7f9048e7d3d0</span>: <span class="hljs-built_in">int</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x106eb62f0</span>&gt;,)
<span class="hljs-number">3</span> <span class="hljs-number">6</span> (&lt;cell at <span class="hljs-number">0x7f9048e7d3d0</span>: <span class="hljs-built_in">int</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x106eb6350</span>&gt;,)
<span class="hljs-number">4</span> <span class="hljs-number">10</span> (&lt;cell at <span class="hljs-number">0x7f9048e7d3d0</span>: <span class="hljs-built_in">int</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x106eb63d0</span>&gt;,)
<span class="hljs-number">5</span> <span class="hljs-number">15</span> (&lt;cell at <span class="hljs-number">0x7f9048e7d3d0</span>: <span class="hljs-built_in">int</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x106eb6470</span>&gt;,)
<span class="hljs-number">6</span> <span class="hljs-number">21</span> (&lt;cell at <span class="hljs-number">0x7f9048e7d3d0</span>: <span class="hljs-built_in">int</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x106eb6530</span>&gt;,)
<span class="hljs-number">7</span> <span class="hljs-number">28</span> (&lt;cell at <span class="hljs-number">0x7f9048e7d3d0</span>: <span class="hljs-built_in">int</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x106eb6610</span>&gt;,)
<span class="hljs-number">8</span> <span class="hljs-number">36</span> (&lt;cell at <span class="hljs-number">0x7f9048e7d3d0</span>: <span class="hljs-built_in">int</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x106eb6710</span>&gt;,)
<span class="hljs-number">9</span> <span class="hljs-number">45</span> (&lt;cell at <span class="hljs-number">0x7f9048e7d3d0</span>: <span class="hljs-built_in">int</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0x106eb6830</span>&gt;,)</code></pre>

<h5 id="Java中的闭包"><a href="#Java中的闭包" class="headerlink" title="Java中的闭包"></a>Java中的闭包</h5><p>1.8以后，可以使用Function接口和Lambda表达式可以创建函数对象；</p>
<p>1.8之前，可以使用Lambda表达式或者匿名内部类也可以实现闭包；</p>
<pre><code class="hljs Java"><span class="hljs-keyword">import</span> javax.xml.ws.Holder;
<span class="hljs-keyword">import</span> java.util.function.Function;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyTest</span> </span>&#123;

    <span class="hljs-keyword">final</span> Holder&lt;Integer&gt; sum = <span class="hljs-keyword">new</span> Holder&lt;&gt;(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">public</span>  Function&lt;Integer, Integer&gt;testClosure()&#123;
        <span class="hljs-comment">// 闭包  使用Function接口和Lambda表达式可以创建函数对象</span>
        <span class="hljs-keyword">return</span> (Integer value) -&gt; &#123;
            sum.value += value;
            <span class="hljs-keyword">return</span> sum.value;
        &#125;;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        MyTest mt = <span class="hljs-keyword">new</span> MyTest();
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;
            System.out.println(i +<span class="hljs-string">&quot;, &quot;</span>+ mt.testClosure().apply(<span class="hljs-keyword">new</span> Integer(i)));
        &#125;
    &#125;
&#125;</code></pre>

<h4 id="闭包应用"><a href="#闭包应用" class="headerlink" title="闭包应用"></a>闭包应用</h4><h6 id="为函数实现接口"><a href="#为函数实现接口" class="headerlink" title="为函数实现接口"></a>为函数实现接口</h6><h6 id="实现函数遍历二叉树"><a href="#实现函数遍历二叉树" class="headerlink" title="实现函数遍历二叉树"></a>实现函数遍历二叉树</h6><h3 id="defer-recover在简单web服务应用"><a href="#defer-recover在简单web服务应用" class="headerlink" title="defer/recover在简单web服务应用"></a>defer/recover在简单web服务应用</h3><p>代码结构<img src="/images/Golang/web.jpg" srcset="/img/loading.gif"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/tree/master/go/web/">https://github.com/weitrue/note/tree/master/go/web/</a></p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><em>表格驱动</em>测试</p>
<pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestMaxNoRepeatedZhn</span><span class="hljs-params">(t *testing.T)</span></span> &#123;
	tests := []<span class="hljs-keyword">struct</span>&#123;
		s <span class="hljs-keyword">string</span>
		ans <span class="hljs-keyword">int</span>
	&#125;&#123;
		&#123;<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">1</span>&#125;,
		&#123;<span class="hljs-string">&quot;yes, 我爱gogogo&quot;</span>, <span class="hljs-number">9</span>&#125;,
		&#123;<span class="hljs-string">&quot;abcadcb&quot;</span>, <span class="hljs-number">4</span>&#125;,
		&#123;<span class="hljs-string">&quot;黑化肥挥发发灰会花飞灰化肥挥发发黑会飞花&quot;</span>, <span class="hljs-number">8</span>&#125;,
	&#125;

	<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests &#123;
		act := MaxNoRepeatedZhn(tt.s)
		<span class="hljs-keyword">if</span> act != tt.ans &#123;
			t.Errorf(<span class="hljs-string">&quot;get %d for input %s , but expect %d&quot;</span>, act, tt.s, tt.ans)
		&#125;
	&#125;
&#125;

<span class="hljs-comment">// 输出</span>
=== RUN   TestMaxNoRepeatedZhn
--- PASS: TestMaxNoRepeatedZhn (<span class="hljs-number">0.00</span>s)
PASS</code></pre>



<h4 id="覆盖测试"><a href="#覆盖测试" class="headerlink" title="覆盖测试"></a>覆盖测试</h4><p><code>go tool cover</code></p>
<pre><code class="hljs zsh">Usage of <span class="hljs-string">&#x27;go tool cover&#x27;</span>:
Given a coverage profile produced by <span class="hljs-string">&#x27;go test&#x27;</span>:
        go <span class="hljs-built_in">test</span> -coverprofile=c.out

Open a web browser displaying annotated <span class="hljs-built_in">source</span> code:
        go tool cover -html=c.out    <span class="hljs-comment"># 常用</span>

Write out an HTML file instead of launching a web browser:
        go tool cover -html=c.out -o coverage.html

Display coverage percentages to stdout <span class="hljs-keyword">for</span> each <span class="hljs-keyword">function</span>:
        go tool cover -func=c.out

Finally, to generate modified <span class="hljs-built_in">source</span> code with coverage annotations
(what go <span class="hljs-built_in">test</span> -cover does):
        go tool cover -mode=<span class="hljs-built_in">set</span> -var=CoverageVariableName program.go

Flags:
  -V    <span class="hljs-built_in">print</span> version and <span class="hljs-built_in">exit</span>
  -func string
        output coverage profile information <span class="hljs-keyword">for</span> each <span class="hljs-keyword">function</span>
  -html string
        generate HTML representation of coverage profile
  -mode string
        coverage mode: <span class="hljs-built_in">set</span>, count, atomic
  -o string
        file <span class="hljs-keyword">for</span> output; default: stdout
  -var string
        name of coverage variable to generate (default <span class="hljs-string">&quot;GoCover&quot;</span>)

  Only one of -html, -func, or -mode may be <span class="hljs-built_in">set</span>.
</code></pre>

<h4 id="Benchmark"><a href="#Benchmark" class="headerlink" title="Benchmark"></a><code>Benchmark</code></h4><pre><code class="hljs golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">BenchmarkMaxNoRepeatedZhn</span><span class="hljs-params">(b *testing.B)</span></span> &#123;
	s := <span class="hljs-string">&quot;黑化肥挥发发灰会花飞灰化肥挥发发黑会飞花&quot;</span>
	ans := <span class="hljs-number">8</span>

	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; b.N; i++ &#123;
		act := MaxNoRepeatedZhn(s)
		<span class="hljs-keyword">if</span> act != ans &#123;
			b.Errorf(<span class="hljs-string">&quot;get %d for input %s , but expect %d&quot;</span>, act, s, ans)
		&#125;
	&#125;
&#125;


<span class="hljs-comment">// 输出</span>
goos: darwin
goarch: amd64
pkg: offer/note/collections
BenchmarkMaxNoRepeatedZhn
BenchmarkMaxNoRepeatedZhn<span class="hljs-number">-8</span>   	 <span class="hljs-number">1097594</span>	      <span class="hljs-number">1024</span> ns/op
PASS</code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/weitrue/note/collections/strings_test.go">https://github.com/weitrue/note/collections/strings_test.go</a></p>
<h4 id="pprof性能测试"><a href="#pprof性能测试" class="headerlink" title="pprof性能测试"></a>pprof性能测试</h4><pre><code class="hljs zsh">xxx@xxxdeMacBook-Pro  ~/Projects/golang/src/offer/note/collections master ±✚ go <span class="hljs-built_in">test</span> -bench . -cpuprofile cpu.out
goos: darwin
goarch: amd64
pkg: offer/note/collections
BenchmarkMaxNoRepeatedZhn-8      1286594               934 ns/op
PASS
ok      offer/note/collections  2.656s
xxx@xxxdeMacBook-Pro  ~/Projects/golang/src/offer/note/collections master ±✚ go tool pprof cpu.out               
Type: cpu
Time: Mar 2, 2021 at 6:03pm (CST)
Duration: 2.34s, Total samples = 2.05s (87.57%)
Entering interactive mode (<span class="hljs-built_in">type</span> <span class="hljs-string">&quot;help&quot;</span> <span class="hljs-keyword">for</span> commands, <span class="hljs-string">&quot;o&quot;</span> <span class="hljs-keyword">for</span> options)
(pprof) web
failed to execute dot. Is Graphviz installed? Error: <span class="hljs-built_in">exec</span>: <span class="hljs-string">&quot;dot&quot;</span>: executable file not found <span class="hljs-keyword">in</span> <span class="hljs-variable">$PATH</span>
(pprof)</code></pre>

<p>☞<code>failed to execute dot. Is Graphviz installed? Error: exec: &quot;dot&quot;: executable file not found in $PATH</code>是因为电脑未安装生成.svg文件的工具<code>Graphviz</code></p>
<h5 id="安装Graphviz"><a href="#安装Graphviz" class="headerlink" title="安装Graphviz"></a>安装<code>Graphviz</code></h5><pre><code class="hljs zsh">brew install graphviz


xxx@xxxdeMacBook-Pro  ~/Projects/golang/src/github.com  brew install graphviz
Error:
  homebrew-core is a shallow <span class="hljs-built_in">clone</span>.
  homebrew-cask is a shallow <span class="hljs-built_in">clone</span>.
To `brew update`, first run:
  git -C /usr/<span class="hljs-built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-core fetch --unshallow
  git -C /usr/<span class="hljs-built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-cask fetch --unshallow
These commands may take a few minutes to run due to the large size of the repositories.
This restriction has been made on GitHub<span class="hljs-string">&#x27;s request because updating shallow</span>
<span class="hljs-string">clones is an extremely expensive operation due to the tree layout and traffic of</span>
<span class="hljs-string">Homebrew/homebrew-core and Homebrew/homebrew-cask. We don&#x27;</span>t <span class="hljs-keyword">do</span> this <span class="hljs-keyword">for</span> you
automatically to avoid repeatedly performing an expensive unshallow operation <span class="hljs-keyword">in</span>
CI systems (<span class="hljs-built_in">which</span> should instead be fixed to not use shallow clones). Sorry <span class="hljs-keyword">for</span>
the inconvenience!
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/libpng-1.6.37.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/freetype-2.10.4.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/fontconfig-2.13.1.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/jpeg-9d.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/libtiff-4.1.0_1.big_sur.bottle.tar.gz
<span class="hljs-comment">#########################################                                 58.1%</span>
curl: (56) LibreSSL SSL_read: SSL_ERROR_SYSCALL, errno 54
Error: Failed to download resource <span class="hljs-string">&quot;libtiff&quot;</span>
Download failed: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/libtiff-4.1.0_1.big_sur.bottle.tar.gz
Warning: Bottle installation failed: building from <span class="hljs-built_in">source</span>.
==&gt; Downloading https://download.osgeo.org/libtiff/tiff-4.1.0.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/webp-1.1.0.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/gd-2.3.0.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/libffi-3.3.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/pcre-8.44.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/glib-2.66.2_1.big_sur.bottle.tar.gz
<span class="hljs-comment">##########                                                                14.5%</span>
curl: (56) LibreSSL SSL_read: SSL_ERROR_SYSCALL, errno 54
Error: Failed to download resource <span class="hljs-string">&quot;glib&quot;</span>
Download failed: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/glib-2.66.2_1.big_sur.bottle.tar.gz
Warning: Bottle installation failed: building from <span class="hljs-built_in">source</span>.
==&gt; Downloading https://raw.githubusercontent.com/Homebrew/formula-patches/6164294a75541c278f3863b111791376caa3ad26/glib/hardcoded-paths.diff
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://download.gnome.org/sources/glib/2.66/glib-2.66.2.tar.xz
==&gt; Downloading from https://mirrors.ustc.edu.cn/gnome/sources/glib/2.66/glib-2.66.2.tar.xz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/jasper-2.0.22.big_sur.bottle.tar.gz
==&gt; Downloading from https://d29vzk4ow07wi7.cloudfront.net/ad3715537b3001b9a8924896e5c4e7eb90b21bb37e7171d964de2008edb13910?response-content-disposition=attachment%3Bfilename%3D%22jasper-2.0.22.big_sur.bo
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/netpbm-10.86.17.big_sur.bottle.tar.gz
==&gt; Downloading from https://d29vzk4ow07wi7.cloudfront.net/3540b31b88e9d8fc7288de5dac7b96be6f1c6652c604cfd167113bdf07738ca7?response-content-disposition=attachment%3Bfilename%3D%22netpbm-10.86.17.big_sur.
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/gts-0.7.6_2.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/lzo-2.10.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/pixman-0.40.0.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/cairo-1.16.0_3.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/gdk-pixbuf-2.42.0.big_sur.bottle.tar.gz
==&gt; Downloading from https://d29vzk4ow07wi7.cloudfront.net/1819bb48f7487d522a69c564dca6fe5dff4da658269f067e47edccddfaab9440?response-content-disposition=attachment%3Bfilename%3D%22gdk-pixbuf-2.42.0.big_su
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/fribidi-1.0.10.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/pkg-config-0.29.2_3.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/gobject-introspection-1.66.1_1.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/graphite2-1.3.14.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/icu4c-67.1.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/harfbuzz-2.7.2.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/pango-1.48.0.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/librsvg-2.50.2.big_sur.bottle.tar.gz
<span class="hljs-comment">#####################                                                     29.6%</span>
curl: (18) transfer closed with 28187304 bytes remaining to <span class="hljs-built_in">read</span>
Error: Failed to download resource <span class="hljs-string">&quot;librsvg&quot;</span>
Download failed: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/librsvg-2.50.2.big_sur.bottle.tar.gz
Warning: Bottle installation failed: building from <span class="hljs-built_in">source</span>.
==&gt; Downloading https://download.gnome.org/sources/librsvg/2.50/librsvg-2.50.2.tar.xz
==&gt; Downloading from https://mirrors.ustc.edu.cn/gnome/sources/librsvg/2.50/librsvg-2.50.2.tar.xz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/libtool-2.4.6_2.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/graphviz-2.44.1.big_sur.bottle.1.tar.gz
<span class="hljs-comment">######################################                                    52.9%</span>
curl: (18) transfer closed with 6363689 bytes remaining to <span class="hljs-built_in">read</span>
Error: Failed to download resource <span class="hljs-string">&quot;graphviz&quot;</span>
Download failed: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/graphviz-2.44.1.big_sur.bottle.1.tar.gz
Warning: Bottle installation failed: building from <span class="hljs-built_in">source</span>.
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/autoconf-2.69.big_sur.bottle.4.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/automake-1.16.3.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/pkg-config-0.29.2_3.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/c393e3a39326eab27929f0f2ce40cb425e78bd8812166e6d835a08a8bf0c5f56--pkg-config-0.29.2_3.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/libpng-1.6.37.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/3bd2e2a75fbfc893d9acc20eeafc5274e260ed2ca39483ccbb1450a734bc6775--libpng-1.6.37.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/freetype-2.10.4.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/1399fc577f7998623378e7bb01f8a716a43eff701304059936d592a76d5a4d31--freetype-2.10.4.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/fontconfig-2.13.1.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/3790f4e94c8e7c868307933e3445a1244aadd794adaa6ed5f743533334489f93--fontconfig-2.13.1.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/jpeg-9d.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/7ed5b41c2937740eca747a8077502454971fbbe02cfb5cfbd9b9e7379345d0cd--jpeg-9d.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/libtiff-4.1.0_1.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/webp-1.1.0.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/1ae441623b4c63d896b5566300b24c06d772ff9f2676d7c9bd692ff6b8e22edb--webp-1.1.0.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/gd-2.3.0.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/d71eed744db212a24cc7f607842253aacf0e1d25cd7891c884ec7ffc969162ac--gd-2.3.0.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/libffi-3.3.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/49892306006d42a1f69ae4b36ff44b37c8e7170f6cf73a20e97f10bf9fa10e72--libffi-3.3.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/pcre-8.44.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/9998b74590fa558f4c346e9770a62495d4aca8e992d0e883435e3574303ee241--pcre-8.44.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/glib-2.66.2_1.big_sur.bottle.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/jasper-2.0.22.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/86ba13e63264cbcafb0dbec9e35960e2662f9e4bde0306bd52984bf487e6581a--jasper-2.0.22.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/netpbm-10.86.17.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/9f8fa63491038e9bb811b03f09660342641c7f8132169bdb3800631d8d2b189e--netpbm-10.86.17.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/gts-0.7.6_2.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/eab94b3870ce0c63232e9a992963c8a32ea53a7efa8a09e639066b40ae0a132b--gts-0.7.6_2.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/lzo-2.10.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/0020e09d8a2c473efa8db2af4b402358f5184578c801c7a7650de6c8bedca06a--lzo-2.10.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/pixman-0.40.0.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/ddf94c89d763f2c63c00ce2090ff16d5abd832ca0e1e9beb2245da3cc159ce41--pixman-0.40.0.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/cairo-1.16.0_3.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/8ad096f68fcc70615ff77f14b50eafbed94e4a261c7860dcda41ba25c7d12f52--cairo-1.16.0_3.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/gdk-pixbuf-2.42.0.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/fb191d15b537de812241fe664f4149209c4d58ce3fbdd5e98a292fe495420f39--gdk-pixbuf-2.42.0.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/fribidi-1.0.10.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/9013c8a0aeb1d2fee9a999ef14adfb2416fef4e8399d87a65d753d44a586427b--fribidi-1.0.10.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/gobject-introspection-1.66.1_1.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/a7f9a1bcb83a7d322e495d163f15b4b8f4d0c05649eeacfcef2681a23b3eb8dd--gobject-introspection-1.66.1_1.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/graphite2-1.3.14.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/5ce053636ab73845d956142cfd518a21701d3ec972e73367d204b81619b8b845--graphite2-1.3.14.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/icu4c-67.1.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/ddca8d436054c0f9c8c333d2e8dd957ccd3902680baf619e4baed434c9806998--icu4c-67.1.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/harfbuzz-2.7.2.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/1aead0f1ab97b4307a9c487a3191213ff63fd200d5eb9be947a11e8ca78df24a--harfbuzz-2.7.2.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/pango-1.48.0.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/eded163bf136aa7a73e07f22c8b16f3a406bbd849b865246a95ee89ecd60aa4e--pango-1.48.0.big_sur.bottle.tar.gz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/librsvg-2.50.2.big_sur.bottle.tar.gz
<span class="hljs-comment">###################################################                       71.3%</span>
curl: (18) transfer closed with 11492026 bytes remaining to <span class="hljs-built_in">read</span>
Error: Failed to download resource <span class="hljs-string">&quot;librsvg&quot;</span>
Download failed: https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/librsvg-2.50.2.big_sur.bottle.tar.gz
Warning: Bottle installation failed: building from <span class="hljs-built_in">source</span>.
==&gt; Downloading https://download.gnome.org/sources/librsvg/2.50/librsvg-2.50.2.tar.xz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/0388827e738392e3705cbb8800e43f279723caf5126ba50c7cd4e1ca5e2af872--librsvg-2.50.2.tar.xz
==&gt; Downloading https://mirrors.tuna.tsinghua.edu.cn/homebrew-bottles/bottles/libtool-2.4.6_2.big_sur.bottle.tar.gz
Already downloaded: /Users/wangpeng/Library/Caches/Homebrew/downloads/59a8e4e9bff6153b4cb25fda4de99648330e04fefdd7e9c98f92fa4d049a9f30--libtool-2.4.6_2.big_sur.bottle.tar.gz
==&gt; Downloading https://www2.graphviz.org/Packages/stable/portable_source/graphviz-2.44.1.tar.gz
<span class="hljs-comment">####################                                                      28.5%</span>
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; Installing dependencies <span class="hljs-keyword">for</span> graphviz: autoconf, automake, pkg-config, libpng, freetype, fontconfig, jpeg, libtiff, webp, gd, libffi, pcre, glib, jasper, netpbm, gts, lzo, pixman, cairo, gdk-pixbuf, fribidi, gobject-introspection, graphite2, icu4c, harfbuzz, pango, librsvg and libtool
==&gt; Installing graphviz dependency: autoconf
==&gt; Pouring autoconf-2.69.big_sur.bottle.4.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/autoconf/2.69: 68 files, 3.0MB
==&gt; Installing graphviz dependency: automake
==&gt; Pouring automake-1.16.3.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/automake/1.16.3: 131 files, 3.4MB
==&gt; Installing graphviz dependency: pkg-config
==&gt; Pouring pkg-config-0.29.2_3.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/pkg-config/0.29.2_3: 11 files, 656.6KB
==&gt; Installing graphviz dependency: libpng
==&gt; Pouring libpng-1.6.37.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/libpng/1.6.37: 27 files, 1.3MB
==&gt; Installing graphviz dependency: freetype
==&gt; Pouring freetype-2.10.4.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/freetype/2.10.4: 64 files, 2.3MB
==&gt; Installing graphviz dependency: fontconfig
==&gt; Pouring fontconfig-2.13.1.big_sur.bottle.tar.gz
==&gt; Regenerating font cache, this may take a <span class="hljs-keyword">while</span>
==&gt; /usr/<span class="hljs-built_in">local</span>/Cellar/fontconfig/2.13.1/bin/fc-cache -frv
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/fontconfig/2.13.1: 531 files, 3.6MB
==&gt; Installing graphviz dependency: jpeg
==&gt; Pouring jpeg-9d.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/jpeg/9d: 21 files, 953.8KB
==&gt; Installing graphviz dependency: libtiff
==&gt; Pouring libtiff-4.1.0_1.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/libtiff/4.1.0_1: 247 files, 4.2MB
==&gt; Installing graphviz dependency: webp
==&gt; Pouring webp-1.1.0.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/webp/1.1.0: 39 files, 2.4MB
==&gt; Installing graphviz dependency: gd
==&gt; Pouring gd-2.3.0.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/gd/2.3.0: 34 files, 1.4MB
==&gt; Installing graphviz dependency: libffi
==&gt; Pouring libffi-3.3.big_sur.bottle.tar.gz
==&gt; Caveats
libffi is keg-only, <span class="hljs-built_in">which</span> means it was not symlinked into /usr/<span class="hljs-built_in">local</span>,
because macOS already provides this software and installing another version <span class="hljs-keyword">in</span>
parallel can cause all kinds of trouble.

For compilers to find libffi you may need to <span class="hljs-built_in">set</span>:
  <span class="hljs-built_in">export</span> LDFLAGS=<span class="hljs-string">&quot;-L/usr/local/opt/libffi/lib&quot;</span>
  <span class="hljs-built_in">export</span> CPPFLAGS=<span class="hljs-string">&quot;-I/usr/local/opt/libffi/include&quot;</span>

For pkg-config to find libffi you may need to <span class="hljs-built_in">set</span>:
  <span class="hljs-built_in">export</span> PKG_CONFIG_PATH=<span class="hljs-string">&quot;/usr/local/opt/libffi/lib/pkgconfig&quot;</span>

==&gt; Summary
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/libffi/3.3: 17 files, 540.2KB
==&gt; Installing graphviz dependency: pcre
==&gt; Pouring pcre-8.44.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/pcre/8.44: 204 files, 5.8MB
==&gt; Installing graphviz dependency: glib
==&gt; Pouring glib-2.66.2_1.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/glib/2.66.2_1: 436 files, 15.5MB
==&gt; Installing graphviz dependency: jasper
==&gt; Pouring jasper-2.0.22.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/jasper/2.0.22: 42 files, 1.5MB
==&gt; Installing graphviz dependency: netpbm
==&gt; Pouring netpbm-10.86.17.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/netpbm/10.86.17: 410 files, 17.7MB
==&gt; Installing graphviz dependency: gts
==&gt; Pouring gts-0.7.6_2.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/gts/0.7.6_2: 27 files, 1.4MB
==&gt; Installing graphviz dependency: lzo
==&gt; Pouring lzo-2.10.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/lzo/2.10: 31 files, 570.7KB
==&gt; Installing graphviz dependency: pixman
==&gt; Pouring pixman-0.40.0.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/pixman/0.40.0: 14 files, 1.3MB
==&gt; Installing graphviz dependency: cairo
==&gt; Pouring cairo-1.16.0_3.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/cairo/1.16.0_3: 119 files, 5.9MB
==&gt; Installing graphviz dependency: gdk-pixbuf
==&gt; Pouring gdk-pixbuf-2.42.0.big_sur.bottle.tar.gz
==&gt; /usr/<span class="hljs-built_in">local</span>/Cellar/gdk-pixbuf/2.42.0/bin/gdk-pixbuf-query-loaders --update-cache
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/gdk-pixbuf/2.42.0: 149 files, 3.8MB
==&gt; Installing graphviz dependency: fribidi
==&gt; Pouring fribidi-1.0.10.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/fribidi/1.0.10: 67 files, 669.0KB
==&gt; Installing graphviz dependency: gobject-introspection
==&gt; Pouring gobject-introspection-1.66.1_1.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/gobject-introspection/1.66.1_1: 191 files, 12.7MB
==&gt; Installing graphviz dependency: graphite2
==&gt; Pouring graphite2-1.3.14.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/graphite2/1.3.14: 18 files, 291.7KB
==&gt; Installing graphviz dependency: icu4c
==&gt; Pouring icu4c-67.1.big_sur.bottle.tar.gz
==&gt; Caveats
icu4c is keg-only, <span class="hljs-built_in">which</span> means it was not symlinked into /usr/<span class="hljs-built_in">local</span>,
because macOS provides libicucore.dylib (but nothing <span class="hljs-keyword">else</span>).

If you need to have icu4c first <span class="hljs-keyword">in</span> your PATH run:
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;export PATH=&quot;/usr/local/opt/icu4c/bin:$PATH&quot;&#x27;</span> &gt;&gt; ~/.zshrc
  <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;export PATH=&quot;/usr/local/opt/icu4c/sbin:$PATH&quot;&#x27;</span> &gt;&gt; ~/.zshrc

For compilers to find icu4c you may need to <span class="hljs-built_in">set</span>:
  <span class="hljs-built_in">export</span> LDFLAGS=<span class="hljs-string">&quot;-L/usr/local/opt/icu4c/lib&quot;</span>
  <span class="hljs-built_in">export</span> CPPFLAGS=<span class="hljs-string">&quot;-I/usr/local/opt/icu4c/include&quot;</span>

For pkg-config to find icu4c you may need to <span class="hljs-built_in">set</span>:
  <span class="hljs-built_in">export</span> PKG_CONFIG_PATH=<span class="hljs-string">&quot;/usr/local/opt/icu4c/lib/pkgconfig&quot;</span>

==&gt; Summary
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/icu4c/67.1: 258 files, 71.8MB
==&gt; Installing graphviz dependency: harfbuzz
==&gt; Pouring harfbuzz-2.7.2.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/harfbuzz/2.7.2: 68 files, 6.4MB
==&gt; Installing graphviz dependency: pango
==&gt; Pouring pango-1.48.0.big_sur.bottle.tar.gz
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/pango/1.48.0: 64 files, 3MB
==&gt; Installing graphviz dependency: librsvg
==&gt; Pouring librsvg-2.50.2.big_sur.bottle.tar.gz
tar: Error opening archive: Failed to open <span class="hljs-string">&#x27;/Users/wangpeng/Library/Caches/Homebrew/downloads/3eb605900a29b02eb026199f14474efc43e313ee2b9de389706c795eebdc24f5--librsvg-2.50.2.big_sur.bottle.tar.gz&#x27;</span>
Error: Failure <span class="hljs-keyword">while</span> executing; `tar xof /Users/wangpeng/Library/Caches/Homebrew/downloads/3eb605900a29b02eb026199f14474efc43e313ee2b9de389706c795eebdc24f5--librsvg-2.50.2.big_sur.bottle.tar.gz -C /var/folders/zs/2875szcx7jn6lbmqd0jfbprr0000gn/T/d20210302-22554-102pbtw` exited with 1. Here<span class="hljs-string">&#x27;s the output:</span>
<span class="hljs-string">tar: Error opening archive: Failed to open &#x27;</span>/Users/wangpeng/Library/Caches/Homebrew/downloads/3eb605900a29b02eb026199f14474efc43e313ee2b9de389706c795eebdc24f5--librsvg-2.50.2.big_sur.bottle.tar.gz<span class="hljs-string">&#x27;</span>
<span class="hljs-string"></span>
<span class="hljs-string">Warning: Bottle installation failed: building from source.</span>
<span class="hljs-string">==&gt; Installing dependencies for librsvg: libssh2 and rust</span>
<span class="hljs-string">==&gt; Installing librsvg dependency: libssh2</span>
<span class="hljs-string">==&gt; Pouring libssh2-1.9.0_1.big_sur.bottle.tar.gz</span>
<span class="hljs-string">tar: Error opening archive: Failed to open &#x27;</span>/Users/wangpeng/Library/Caches/Homebrew/downloads/45db0c196aa97bf6c0a9c6e7787ad2cd0d14d563c03d0f4e0d52392a0f3a1c81--libssh2-1.9.0_1.big_sur.bottle.tar.gz<span class="hljs-string">&#x27;</span>
<span class="hljs-string">Error: Failure while executing; `tar xof /Users/wangpeng/Library/Caches/Homebrew/downloads/45db0c196aa97bf6c0a9c6e7787ad2cd0d14d563c03d0f4e0d52392a0f3a1c81--libssh2-1.9.0_1.big_sur.bottle.tar.gz -C /var/folders/zs/2875szcx7jn6lbmqd0jfbprr0000gn/T/d20210302-22554-qzrgbb` exited with 1. Here&#x27;</span>s the output:
tar: Error opening archive: Failed to open <span class="hljs-string">&#x27;/Users/wangpeng/Library/Caches/Homebrew/downloads/45db0c196aa97bf6c0a9c6e7787ad2cd0d14d563c03d0f4e0d52392a0f3a1c81--libssh2-1.9.0_1.big_sur.bottle.tar.gz&#x27;</span>

Warning: Bottle installation failed: building from <span class="hljs-built_in">source</span>.
==&gt; Downloading https://libssh2.org/download/libssh2-1.9.0.tar.gz
<span class="hljs-comment">######################################################################## 100.0%</span>
==&gt; ./configure --prefix=/usr/<span class="hljs-built_in">local</span>/Cellar/libssh2/1.9.0_1 --disable-examples-build --with-openssl --with-libz --with-libssl-prefix=/usr/<span class="hljs-built_in">local</span>/opt/openssl@1.1
==&gt; make install
🍺  /usr/<span class="hljs-built_in">local</span>/Cellar/libssh2/1.9.0_1: 184 files, 969.9KB, built <span class="hljs-keyword">in</span> 33 seconds
==&gt; Installing librsvg dependency: rust
==&gt; Pouring rust-1.47.0.big_sur.bottle.tar.gz
tar: Error opening archive: Failed to open <span class="hljs-string">&#x27;/Users/wangpeng/Library/Caches/Homebrew/downloads/f1482d118ddb120ff152e8f8aa88afa9bebc5674cc42aebca96249cffbdd8bdb--rust-1.47.0.big_sur.bottle.tar.gz&#x27;</span>
Error: Failure <span class="hljs-keyword">while</span> executing; `tar xof /Users/wangpeng/Library/Caches/Homebrew/downloads/f1482d118ddb120ff152e8f8aa88afa9bebc5674cc42aebca96249cffbdd8bdb--rust-1.47.0.big_sur.bottle.tar.gz -C /var/folders/zs/2875szcx7jn6lbmqd0jfbprr0000gn/T/d20210302-22554-16tqegl` exited with 1. Here<span class="hljs-string">&#x27;s the output:</span>
<span class="hljs-string">tar: Error opening archive: Failed to open &#x27;</span>/Users/wangpeng/Library/Caches/Homebrew/downloads/f1482d118ddb120ff152e8f8aa88afa9bebc5674cc42aebca96249cffbdd8bdb--rust-1.47.0.big_sur.bottle.tar.gz<span class="hljs-string">&#x27;</span>
<span class="hljs-string"></span>
<span class="hljs-string">Warning: Bottle installation failed: building from source.</span>
<span class="hljs-string">==&gt; Downloading https://static.rust-lang.org/dist/rustc-1.47.0-src.tar.gz</span>
<span class="hljs-string">######################################################################## 100.0%</span>
<span class="hljs-string">==&gt; ./configure --prefix=/usr/local/Cellar/rust/1.47.0 --release-channel=stable</span>
<span class="hljs-string">==&gt; make</span>
<span class="hljs-string">Last 15 lines from /Users/wangpeng/Library/Logs/Homebrew/rust/02.make:</span>
<span class="hljs-string">error: failed to get `cc` as a dependency of package `bootstrap v0.0.0 (/private/tmp/rust-20210302-29879-dftrmf/rustc-1.47.0-src/src/bootstrap)`</span>
<span class="hljs-string"></span>
<span class="hljs-string">Caused by:</span>
<span class="hljs-string">  failed to fetch `https://github.com/rust-lang/crates.io-index`</span>
<span class="hljs-string"></span>
<span class="hljs-string">Caused by:</span>
<span class="hljs-string">  network failure seems to have happened</span>
<span class="hljs-string">  if a proxy or similar is necessary `net.git-fetch-with-cli` may help here</span>
<span class="hljs-string">  https://doc.rust-lang.org/cargo/reference/config.html#netgit-fetch-with-cli</span>
<span class="hljs-string"></span>
<span class="hljs-string">Caused by:</span>
<span class="hljs-string">  http parser error: stream ended at an unexpected time; class=Http (34)</span>
<span class="hljs-string">failed to run: /private/tmp/rust-20210302-29879-dftrmf/rustc-1.47.0-src/build/x86_64-apple-darwin/stage0/bin/cargo build --manifest-path /private/tmp/rust-20210302-29879-dftrmf/rustc-1.47.0-src/src/bootstrap/Cargo.toml</span>
<span class="hljs-string">Build completed unsuccessfully in 0:33:17</span>
<span class="hljs-string">make: *** [all] Error 1</span>
<span class="hljs-string"></span>
<span class="hljs-string">READ THIS: https://docs.brew.sh/Troubleshooting</span>
<span class="hljs-string"></span>
<span class="hljs-string">These open issues may also help:</span>
<span class="hljs-string">rust 1.50.0 https://github.com/Homebrew/homebrew-core/pull/70922</span>
<span class="hljs-string">Rust-dependent formulae on Apple Silicon - upstream issue tracker https://github.com/Homebrew/homebrew-core/issues/68301</span></code></pre>

<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><p><code>godoc -http :6060</code>,生成网页文档</p>
<p><img src="/images/Golang/doc.jpg" srcset="/img/loading.gif"></p>
<p><img src="/images/Golang/doc1.jpg" srcset="/img/loading.gif"></p>
<p><code>go doc 方法名（包括包名）</code>,查看方法注释</p>
<p><img src="/images/Golang/doc2.jpg" srcset="/img/loading.gif"></p>
<p><code>xxx_test.go</code>生成示例</p>
<pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ExampleQueue_Pop</span><span class="hljs-params">()</span></span> &#123;
	q := Queue&#123;&#125;
	_ = q.Push(<span class="hljs-string">&quot;asd&quot;</span>)
	_ = q.Push(<span class="hljs-number">123</span>)
	<span class="hljs-keyword">if</span> v, ok := q.Pop(); ok &#123;
		fmt.Println(v)
	&#125;
	<span class="hljs-keyword">if</span> v, ok := q.Pop(); ok &#123;
		fmt.Println(v)
	&#125;

	<span class="hljs-comment">//Output:</span>
	<span class="hljs-comment">//asd</span>
	<span class="hljs-comment">//123</span>
&#125;</code></pre>

<p><img src="/images/Golang/doc_output.jpg" srcset="/img/loading.gif"></p>
<h3 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a><code>goroutine</code></h3><p><img src="/images/Golang/goroutine.png" srcset="/img/loading.gif"></p>
<h4 id="协程-Coroutine"><a href="#协程-Coroutine" class="headerlink" title="协程 Coroutine"></a>协程 <code>Coroutine</code></h4><ul>
<li><p><em>轻量级</em>线程</p>
</li>
<li><p><strong>非抢占式</strong>多任务处理，由协程主动交出控制权</p>
</li>
<li><p>编译器/解释器/虚拟机层的多任务</p>
</li>
<li><p>多个协程可以在一个或者多个线程上运行</p>
</li>
</ul>
<h5 id="其他语言对协程的支持"><a href="#其他语言对协程的支持" class="headerlink" title="其他语言对协程的支持"></a>其他语言对协程的支持</h5><p><code>Java</code>：标准库不支持</p>
<p><code>Python</code>：3.5版本前使用yield关键字</p>
<p>​                 3.5以后， <code>async def 方法名</code>实现协程的原生支持</p>
<h5 id="可能切换goroutine的事件"><a href="#可能切换goroutine的事件" class="headerlink" title="可能切换goroutine的事件"></a>可能切换<code>goroutine</code>的事件</h5><ul>
<li><p><code>I/O, Select</code></p>
</li>
<li><p><code>channel</code></p>
</li>
<li><p>等待锁</p>
</li>
<li><p>函数调用</p>
</li>
<li><p><code>runtime.Gosched()</code></p>
</li>
<li><p><code>.e.g</code></p>
</li>
</ul>
<pre><code class="hljs golang"><span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;fmt&quot;</span>
	<span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Run</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i ++ &#123;
		<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(j <span class="hljs-keyword">int</span>)</span></span> &#123;
			<span class="hljs-keyword">for</span>&#123;
				fmt.Println(<span class="hljs-string">&quot;go run from&quot;</span>, j)
			&#125;
		&#125;(i)
	&#125;
	time.Sleep(time.Minute)
&#125;</code></pre>

<h4 id="channel"><a href="#channel" class="headerlink" title="channel"></a><code>channel</code></h4><p><img src="/images/Golang/channel.png" srcset="/img/loading.gif"></p>
 <pre><code class="hljs golang"><span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;fmt&quot;</span>
	<span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">works</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>, c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span>  &#123;
	<span class="hljs-comment">// 不断的从channel取</span>
	<span class="hljs-keyword">for</span>  &#123;
		fmt.Printf(<span class="hljs-string">&quot;channel %d receive %c\n&quot;</span>, id, &lt;-c)
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">workIfNotClose</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>, c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span>  &#123;
	<span class="hljs-comment">// 接收方判断channel中有数据就不断的从channel取</span>
	<span class="hljs-keyword">for</span>  &#123;
		n, ok := &lt;-c
		<span class="hljs-keyword">if</span> !ok&#123;
			<span class="hljs-keyword">break</span>
		&#125;
		fmt.Printf(<span class="hljs-string">&quot;channel %d receive %c\n&quot;</span>, id, n)
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">workIfNotCloseSimple</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>, c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span>  &#123;
	<span class="hljs-comment">// 接收方判断channel中有数据就不断的从channel取</span>
	<span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> c&#123;
		fmt.Printf(<span class="hljs-string">&quot;channel %d receive %c\n&quot;</span>, id, n)
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createWorks</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">chan</span>&lt;- <span class="hljs-title">int</span></span> &#123;
	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
	<span class="hljs-keyword">go</span> works(id, c)
	<span class="hljs-keyword">return</span> c
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">first</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-comment">// 创建channel用例</span>
	<span class="hljs-keyword">var</span> chans [<span class="hljs-number">10</span>]<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>
	<span class="hljs-keyword">for</span>  i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;
		chans[i] = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
		<span class="hljs-keyword">go</span> works(i, chans[i])
	&#125;
	<span class="hljs-comment">// 往channel放</span>
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;
		chans[i] &lt;- <span class="hljs-string">&#x27;a&#x27;</span> + i
	&#125;
	<span class="hljs-comment">// 往channel放</span>
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;
		chans[i] &lt;- <span class="hljs-string">&#x27;A&#x27;</span> + i
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">second</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-comment">// 只能发数据  chan&lt;- int 将channel 作为函数返回参数  即 channel也是一等公民</span>
	<span class="hljs-keyword">var</span> chann [<span class="hljs-number">10</span>] <span class="hljs-keyword">chan</span>&lt;- <span class="hljs-keyword">int</span>
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;
		chann[i] = createWorks(i)
	&#125;

	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;
		chann[i] &lt;- <span class="hljs-string">&#x27;k&#x27;</span> + i
	&#125;

	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;
		chann[i] &lt;- <span class="hljs-string">&#x27;K&#x27;</span> + i
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">thirdBufferedChannel</span><span class="hljs-params">()</span></span> &#123;
	<span class="hljs-comment">// channel缓冲区   可以放入不大于缓冲区的大小时，可以不用取</span>
	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">4</span>)
	<span class="hljs-keyword">go</span> works(<span class="hljs-number">0</span>, c)
	c &lt;- <span class="hljs-string">&#x27;u&#x27;</span>
	c &lt;- <span class="hljs-string">&#x27;v&#x27;</span>
	c &lt;- <span class="hljs-string">&#x27;w&#x27;</span>
	c &lt;- <span class="hljs-string">&#x27;x&#x27;</span>
	c &lt;- <span class="hljs-string">&#x27;y&#x27;</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">channelClose</span><span class="hljs-params">()</span></span>  &#123;
	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>, <span class="hljs-number">4</span>)
	<span class="hljs-keyword">go</span> workIfNotCloseSimple(<span class="hljs-number">0</span>, c)
	c &lt;- <span class="hljs-string">&#x27;U&#x27;</span>
	c &lt;- <span class="hljs-string">&#x27;V&#x27;</span>
	c &lt;- <span class="hljs-string">&#x27;W&#x27;</span>
	<span class="hljs-built_in">close</span>(c)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ChanDemo</span><span class="hljs-params">()</span></span>  &#123;

	<span class="hljs-comment">//  channel也是一等公民</span>
	first()
	second()
	fmt.Println(<span class="hljs-string">&quot;-----------------&quot;</span>)
	thirdBufferedChannel()

	channelClose()

	time.Sleep(time.Second)
&#125;


<span class="hljs-comment">// 输出</span>
channel <span class="hljs-number">7</span> receive h
channel <span class="hljs-number">9</span> receive j
channel <span class="hljs-number">8</span> receive i
channel <span class="hljs-number">5</span> receive f
channel <span class="hljs-number">3</span> receive d
channel <span class="hljs-number">6</span> receive g
channel <span class="hljs-number">4</span> receive e
channel <span class="hljs-number">2</span> receive c
channel <span class="hljs-number">1</span> receive b
channel <span class="hljs-number">0</span> receive a
channel <span class="hljs-number">0</span> receive A
-----------------
channel <span class="hljs-number">4</span> receive E
channel <span class="hljs-number">3</span> receive D
channel <span class="hljs-number">1</span> receive B
channel <span class="hljs-number">7</span> receive H
channel <span class="hljs-number">2</span> receive C
channel <span class="hljs-number">5</span> receive F
channel <span class="hljs-number">6</span> receive G
channel <span class="hljs-number">9</span> receive J
channel <span class="hljs-number">8</span> receive I
channel <span class="hljs-number">0</span> receive k
channel <span class="hljs-number">1</span> receive l
channel <span class="hljs-number">2</span> receive m
channel <span class="hljs-number">3</span> receive n
channel <span class="hljs-number">4</span> receive o
channel <span class="hljs-number">5</span> receive p
channel <span class="hljs-number">6</span> receive q
channel <span class="hljs-number">7</span> receive r
channel <span class="hljs-number">7</span> receive R
channel <span class="hljs-number">8</span> receive s
channel <span class="hljs-number">8</span> receive S
channel <span class="hljs-number">3</span> receive N
channel <span class="hljs-number">5</span> receive P
channel <span class="hljs-number">0</span> receive K
channel <span class="hljs-number">6</span> receive Q
channel <span class="hljs-number">9</span> receive t
channel <span class="hljs-number">9</span> receive T
channel <span class="hljs-number">2</span> receive M
channel <span class="hljs-number">4</span> receive O
channel <span class="hljs-number">1</span> receive L
-----------------
channel <span class="hljs-number">0</span> receive u
channel <span class="hljs-number">0</span> receive v
channel <span class="hljs-number">0</span> receive w
channel <span class="hljs-number">0</span> receive x
channel <span class="hljs-number">0</span> receive y
channel <span class="hljs-number">0</span> receive U
channel <span class="hljs-number">0</span> receive V
channel <span class="hljs-number">0</span> receive W
Exiting.
</code></pre>

<h5 id="通过通信来共享内存"><a href="#通过通信来共享内存" class="headerlink" title="通过通信来共享内存"></a>通过通信来共享内存</h5><pre><code class="hljs golang"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Author: Wang P</span>
<span class="hljs-comment"> * Version: 1.0.0</span>
<span class="hljs-comment"> * Date: 2021/2/5 下午5:05</span>
<span class="hljs-comment"> * Description:</span>
<span class="hljs-comment"> **/</span>

<span class="hljs-keyword">package</span> goroutines

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;fmt&quot;</span>
)

<span class="hljs-keyword">type</span> Worker <span class="hljs-keyword">struct</span> &#123;
	in <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>
	done <span class="hljs-keyword">chan</span> <span class="hljs-keyword">bool</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">doWork</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>, w Worker)</span></span>  &#123;
	<span class="hljs-comment">// 接收方判断channel中有数据就不断的从channel取</span>
	<span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> w.in&#123;
		fmt.Printf(<span class="hljs-string">&quot;channel %d receive %c\n&quot;</span>, id, n)
		w.done &lt;- <span class="hljs-literal">true</span>
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createWorkers</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">Worker</span></span> &#123;
	w := Worker&#123;
		in: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>),
		done: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">bool</span>),
	&#125;
	<span class="hljs-keyword">go</span> doWork(id, w)
	<span class="hljs-keyword">return</span> w
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">communicate</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-comment">// 只能发数据  chan&lt;- int 将channel 作为函数返回参数  即 channel也是一等公民</span>
	<span class="hljs-keyword">var</span> works [<span class="hljs-number">10</span>]Worker
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;
		works[i] = createWorkers(i)
	&#125;

	<span class="hljs-keyword">for</span> i, worker := <span class="hljs-keyword">range</span> works&#123;
		worker.in &lt;- <span class="hljs-string">&#x27;a&#x27;</span> + i
	&#125;

	<span class="hljs-keyword">for</span> _, worker := <span class="hljs-keyword">range</span> works&#123;
		&lt;- worker.done
	&#125;

	<span class="hljs-keyword">for</span> i, worker := <span class="hljs-keyword">range</span> works&#123;
		worker.in &lt;- <span class="hljs-string">&#x27;A&#x27;</span> + i
	&#125;

	<span class="hljs-keyword">for</span> _, worker := <span class="hljs-keyword">range</span> works&#123;
		&lt;- worker.done
	&#125;
&#125;


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">doWork2</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>, w Worker)</span></span>  &#123;
	<span class="hljs-comment">// 接收方判断channel中有数据就不断的从channel取</span>
	<span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> w.in&#123;
		fmt.Printf(<span class="hljs-string">&quot;channel %d receive %c\n&quot;</span>, id, n)
		<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
			w.done &lt;- <span class="hljs-literal">true</span>
		&#125;()
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createWorkers2</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>)</span> <span class="hljs-title">Worker</span></span> &#123;
	w := Worker&#123;
		in: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>),
		done: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">bool</span>),
	&#125;
	<span class="hljs-keyword">go</span> doWork2(id, w)
	<span class="hljs-keyword">return</span> w
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">communicateDoneAll</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-comment">// 只能发数据  chan&lt;- int 将channel 作为函数返回参数  即 channel也是一等公民</span>
	<span class="hljs-keyword">var</span> worksAll [<span class="hljs-number">10</span>]Worker

	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;
		worksAll[i] = createWorkers2(i)
	&#125;

	<span class="hljs-keyword">for</span> i, worker := <span class="hljs-keyword">range</span> worksAll &#123;
		worker.in &lt;- <span class="hljs-string">&#x27;j&#x27;</span> + i
	&#125;

	<span class="hljs-keyword">for</span> i, worker := <span class="hljs-keyword">range</span> worksAll &#123;
		worker.in &lt;- <span class="hljs-string">&#x27;J&#x27;</span> + i
	&#125;

	<span class="hljs-comment">// 等所有任务都取完 再结束</span>
	<span class="hljs-keyword">for</span> _, worker := <span class="hljs-keyword">range</span> worksAll &#123;
		&lt;- worker.done
		&lt;- worker.done
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">communicateDemo</span><span class="hljs-params">()</span></span>  &#123;
	communicate()
	fmt.Println(<span class="hljs-string">&quot;----------------&quot;</span>)
	communicateDoneAll()
&#125;

<span class="hljs-comment">// 输出</span>
channel <span class="hljs-number">7</span> receive h
channel <span class="hljs-number">5</span> receive f
channel <span class="hljs-number">8</span> receive i
channel <span class="hljs-number">9</span> receive j
channel <span class="hljs-number">2</span> receive c
channel <span class="hljs-number">3</span> receive d
channel <span class="hljs-number">1</span> receive b
channel <span class="hljs-number">0</span> receive a
channel <span class="hljs-number">4</span> receive e
channel <span class="hljs-number">6</span> receive g
channel <span class="hljs-number">6</span> receive G
channel <span class="hljs-number">7</span> receive H
channel <span class="hljs-number">8</span> receive I
channel <span class="hljs-number">9</span> receive J
channel <span class="hljs-number">0</span> receive A
channel <span class="hljs-number">1</span> receive B
channel <span class="hljs-number">2</span> receive C
channel <span class="hljs-number">3</span> receive D
channel <span class="hljs-number">5</span> receive F
channel <span class="hljs-number">4</span> receive E
----------------
channel <span class="hljs-number">0</span> receive j
channel <span class="hljs-number">1</span> receive k
channel <span class="hljs-number">4</span> receive n
channel <span class="hljs-number">2</span> receive l
channel <span class="hljs-number">3</span> receive m
channel <span class="hljs-number">2</span> receive L
channel <span class="hljs-number">8</span> receive r
channel <span class="hljs-number">0</span> receive J
channel <span class="hljs-number">1</span> receive K
channel <span class="hljs-number">7</span> receive q
channel <span class="hljs-number">5</span> receive o
channel <span class="hljs-number">9</span> receive s
channel <span class="hljs-number">3</span> receive M
channel <span class="hljs-number">5</span> receive O
channel <span class="hljs-number">6</span> receive p
channel <span class="hljs-number">4</span> receive N
channel <span class="hljs-number">6</span> receive P
channel <span class="hljs-number">9</span> receive S
channel <span class="hljs-number">7</span> receive Q
channel <span class="hljs-number">8</span> receive R</code></pre>

<h5 id="利用channel遍历树"><a href="#利用channel遍历树" class="headerlink" title="利用channel遍历树"></a>利用channel遍历树</h5><pre><code class="hljs golang"><span class="hljs-keyword">package</span> goroutines

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span>

<span class="hljs-keyword">type</span> Node <span class="hljs-keyword">struct</span> &#123;
	Value       <span class="hljs-keyword">int</span>
	Left, Right *Node
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createNode</span><span class="hljs-params">(value <span class="hljs-keyword">int</span>)</span> *<span class="hljs-title">Node</span></span> &#123;
	<span class="hljs-keyword">return</span> &amp;Node&#123;Value: value&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(node *Node)</span> <span class="hljs-title">setValue</span><span class="hljs-params">(value <span class="hljs-keyword">int</span>)</span></span> &#123;
	<span class="hljs-comment">// 接收者使用指针才可以改变结构内容</span>
	<span class="hljs-keyword">if</span> node == <span class="hljs-literal">nil</span> &#123;
		fmt.Println(<span class="hljs-string">&quot;Setting Value to nil node. Ignored.&quot;</span>)
		<span class="hljs-keyword">return</span>
	&#125;
	node.Value = value
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(node *Node)</span> <span class="hljs-title">print</span><span class="hljs-params">()</span></span> &#123;
	<span class="hljs-keyword">if</span> node == <span class="hljs-literal">nil</span> &#123;
		<span class="hljs-keyword">return</span>
	&#125;
	fmt.Print(node.Value, <span class="hljs-string">&quot; &quot;</span>)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(node *Node)</span><span class="hljs-title">travelsWithFunc</span><span class="hljs-params">(f <span class="hljs-keyword">func</span>(*Node)</span>)</span> &#123;
	<span class="hljs-keyword">if</span> node == <span class="hljs-literal">nil</span> &#123;
		<span class="hljs-keyword">return</span>
	&#125;
	node.Left.travelsWithFunc(f)
	f(node)
	node.Right.travelsWithFunc(f)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(node *Node)</span><span class="hljs-title">travelWithChannel</span><span class="hljs-params">()</span> <span class="hljs-title">chan</span> *<span class="hljs-title">Node</span></span>&#123;
	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> *Node)
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
		node.travelsWithFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(node *Node)</span></span> &#123;
			c &lt;- node
		&#125;)
		<span class="hljs-built_in">close</span>(c)
	&#125;()
	<span class="hljs-keyword">return</span> c
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initTree</span><span class="hljs-params">()</span> *<span class="hljs-title">Node</span></span> &#123;
	<span class="hljs-keyword">var</span> root Node
	root = Node&#123;Value: <span class="hljs-number">3</span>&#125;
	root.Left = &amp;Node&#123;&#125;
	root.Right = &amp;Node&#123;<span class="hljs-number">5</span>, <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>&#125;
	root.Right.Left = <span class="hljs-built_in">new</span>(Node)
	root.Left.Right = createNode(<span class="hljs-number">2</span>)
	root.Right.Left.setValue(<span class="hljs-number">4</span>)
	<span class="hljs-keyword">return</span> &amp;root
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Demo</span><span class="hljs-params">()</span></span>  &#123;
	t := initTree()

	<span class="hljs-comment">// 计数</span>
  nodeCount := <span class="hljs-number">0</span>
	t.travelsWithFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(node *Node)</span></span> &#123;
		nodeCount++
	&#125;)
	fmt.Println(<span class="hljs-string">&quot;Node counts&quot;</span>, nodeCount)

	<span class="hljs-comment">// 树中最大值</span>
  c := t.travelWithChannel()
	maxNode := <span class="hljs-number">0</span>
	<span class="hljs-comment">// 从channel中取</span>
	<span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> c &#123;
		<span class="hljs-keyword">if</span> maxNode &lt; n.Value &#123;
			maxNode = n.Value
		&#125;
	&#125;
	fmt.Println(<span class="hljs-string">&quot;Max node:&quot;</span>, maxNode)
&#125;</code></pre>

<h4 id="Select调度"><a href="#Select调度" class="headerlink" title="Select调度"></a><code>Select</code>调度</h4><pre><code class="hljs golang"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Author: Wang P</span>
<span class="hljs-comment"> * Version: 1.0.0</span>
<span class="hljs-comment"> * Date: 2021/2/5 上午10:37</span>
<span class="hljs-comment"> * Description: select</span>
<span class="hljs-comment"> **/</span>

<span class="hljs-keyword">package</span> goroutines

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;fmt&quot;</span>
	<span class="hljs-string">&quot;math/rand&quot;</span>
	<span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">type</span> SelectWorker <span class="hljs-keyword">struct</span> &#123;
	id <span class="hljs-keyword">string</span>
	c <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(w *SelectWorker)</span> <span class="hljs-title">setValue</span><span class="hljs-params">(id <span class="hljs-keyword">string</span>)</span></span>  &#123;
	w.id = id
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">selectNotBlock</span><span class="hljs-params">(c1, c2 <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span>  &#123;
	<span class="hljs-keyword">for</span> &#123;
		<span class="hljs-keyword">select</span> &#123;
		<span class="hljs-keyword">case</span> n := &lt;- c1:
			fmt.Printf(<span class="hljs-string">&quot;receice %d from c1\n&quot;</span>, n)
		<span class="hljs-keyword">case</span> n := &lt;-c2:
			fmt.Printf(<span class="hljs-string">&quot;receice %d from c2\n&quot;</span>, n)
		<span class="hljs-keyword">default</span>:
			fmt.Println(<span class="hljs-string">&quot;not receive anything&quot;</span>)
		&#125;
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">selectBlock</span><span class="hljs-params">(c1, c2 <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)</span></span>  &#123;
	<span class="hljs-keyword">for</span> &#123;
		<span class="hljs-keyword">select</span> &#123;
		<span class="hljs-keyword">case</span> n := &lt;- c1:
			fmt.Printf(<span class="hljs-string">&quot;receice %d from c1\n&quot;</span>, n)
		<span class="hljs-keyword">case</span> n := &lt;-c2:
			fmt.Printf(<span class="hljs-string">&quot;receice %d from c2\n&quot;</span>, n)

		&#125;
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">selectWorkConditionBlock</span><span class="hljs-params">(rw, sw1, sw2 SelectWorker)</span></span>  &#123;
	<span class="hljs-keyword">var</span> values []<span class="hljs-keyword">int</span>
	id := <span class="hljs-string">&quot;&quot;</span>
	endTime := time.After(time.Second * <span class="hljs-number">10</span>)
	tick := time.Tick(time.Second)
	<span class="hljs-keyword">for</span> &#123;
		activeWorker := SelectWorker&#123;
			c:  <span class="hljs-literal">nil</span>,
		&#125;
		<span class="hljs-keyword">var</span> activeValue <span class="hljs-keyword">int</span>
		<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(values) &gt;<span class="hljs-number">0</span> &#123;
			rw.setValue(id)
			activeWorker = rw
			activeValue = values[<span class="hljs-number">0</span>]
		&#125;
		<span class="hljs-keyword">select</span> &#123;
		<span class="hljs-keyword">case</span> n := &lt;-sw1.c:
			id = sw1.id
			values = <span class="hljs-built_in">append</span>(values, n)
		<span class="hljs-keyword">case</span> n := &lt;-sw2.c:
			id = sw2.id
			values = <span class="hljs-built_in">append</span>(values, n)
		<span class="hljs-keyword">case</span> activeWorker.c &lt;- activeValue:
			values = values[<span class="hljs-number">1</span>:]
		<span class="hljs-keyword">case</span> &lt;-time.After(time.Millisecond * <span class="hljs-number">600</span>):  <span class="hljs-comment">// 500毫秒未产生数据</span>
			fmt.Println(<span class="hljs-string">&quot;程序超时&quot;</span>)
		<span class="hljs-keyword">case</span> &lt;- tick:
			fmt.Println(<span class="hljs-string">&quot;queue len = &quot;</span>, <span class="hljs-built_in">len</span>(values))
		<span class="hljs-keyword">case</span> &lt;- endTime:  <span class="hljs-comment">// 程序执行到endTime时结束</span>
			fmt.Println(<span class="hljs-string">&quot;程序执行结束&quot;</span>)
			<span class="hljs-keyword">return</span>
		&#125;
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">generateChannel</span><span class="hljs-params">()</span> <span class="hljs-title">chan</span> <span class="hljs-title">int</span></span>&#123;
	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>)
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
		i := <span class="hljs-number">0</span>
		<span class="hljs-keyword">for</span> &#123;
			time.Sleep(time.Duration(rand.Intn(<span class="hljs-number">1000</span>)) * time.Millisecond)
			c &lt;- i
			i++
		&#125;
	&#125;()
	<span class="hljs-keyword">return</span> c
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">generateWorkChannel</span><span class="hljs-params">(id <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">SelectWorker</span></span> &#123;
	w := SelectWorker&#123;
		id:id,
		c: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>),
	&#125;
	<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
		i := <span class="hljs-number">0</span>
		<span class="hljs-keyword">for</span> &#123;
			time.Sleep(time.Duration(rand.Intn(<span class="hljs-number">1000</span>)) * time.Millisecond)
			w.c &lt;- i
			i++
		&#125;
	&#125;()
	<span class="hljs-keyword">return</span> w
&#125;


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">selectWorks</span><span class="hljs-params">(id <span class="hljs-keyword">string</span>, rw SelectWorker)</span></span>  &#123;
	<span class="hljs-comment">// 不断的从channel取</span>
	<span class="hljs-keyword">for</span>  &#123;
		fmt.Printf(<span class="hljs-string">&quot;channel %s from %s receive %d\n&quot;</span>, id, rw.id, &lt;-rw.c)
		time.Sleep(time.Second)
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createSelectWorks</span><span class="hljs-params">(id <span class="hljs-keyword">string</span>)</span> <span class="hljs-title">SelectWorker</span></span> &#123;
	rw := SelectWorker&#123;
		c:  <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>),
	&#125;
	<span class="hljs-keyword">go</span> selectWorks(id, rw)
	<span class="hljs-keyword">return</span> rw
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">channelSelectBlock</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-keyword">var</span> c1, c2 = generateChannel(), generateChannel()
	selectBlock(c1, c2)
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">channelSelectWork</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-keyword">var</span> sw1, sw2 = generateWorkChannel(<span class="hljs-string">&quot;send worker1&quot;</span>), generateWorkChannel(<span class="hljs-string">&quot;send worker2&quot;</span>)
	rw := createSelectWorks(<span class="hljs-string">&quot;receive work1&quot;</span>)
	selectWorkConditionBlock(rw, sw1, sw2)
&#125;


<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">selectDemo</span><span class="hljs-params">()</span></span>  &#123;

	<span class="hljs-comment">//var c1, c2 chan int</span>
	<span class="hljs-comment">//selectNotBlock(c1, c2)</span>

	<span class="hljs-comment">//channelSelectBlock()</span>

	channelSelectWork()
&#125;
</code></pre>

<h4 id="同步机制"><a href="#同步机制" class="headerlink" title="同步机制"></a>同步机制</h4><ul>
<li><code>WaitGroup</code></li>
</ul>
<p>基于<code>WaitGroup</code>实现通信来共享内存</p>
<pre><code class="hljs golang"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Author: Wang P</span>
<span class="hljs-comment"> * Version: 1.0.0</span>
<span class="hljs-comment"> * Date: 2021/2/5 下午5:37</span>
<span class="hljs-comment"> * Description: 基于WaitGroup实现通信来共享内存</span>
<span class="hljs-comment"> **/</span>

<span class="hljs-keyword">package</span> goroutines

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;fmt&quot;</span>
	<span class="hljs-string">&quot;sync&quot;</span>
)

<span class="hljs-keyword">type</span> WorkerWG <span class="hljs-keyword">struct</span> &#123;
	in <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>
	wg *sync.WaitGroup
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">doWorkWaitDone</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>, w WorkerWG)</span></span>  &#123;
	<span class="hljs-comment">// 接收方判断channel中有数据就不断的从channel取</span>
	<span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> w.in&#123;
		fmt.Printf(<span class="hljs-string">&quot;channel %d receive %c\n&quot;</span>, id, n)
		w.wg.Done()
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createWaitDoneWorkers</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>, wg *sync.WaitGroup)</span> <span class="hljs-title">WorkerWG</span></span> &#123;
	w := WorkerWG&#123;
		in: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>),
		wg: wg,
	&#125;
	<span class="hljs-keyword">go</span> doWorkWaitDone(id, w)
	<span class="hljs-keyword">return</span> w
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">communicateWaitDone</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-comment">// 只能发数据  chan&lt;- int 将channel 作为函数返回参数  即 channel也是一等公民</span>
	<span class="hljs-keyword">var</span> works [<span class="hljs-number">10</span>]WorkerWG
	<span class="hljs-keyword">var</span> wg sync.WaitGroup
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;
		works[i] = createWaitDoneWorkers(i, &amp;wg)
	&#125;

	<span class="hljs-comment">//wg.Add(20)</span>

	<span class="hljs-keyword">for</span> i, worker := <span class="hljs-keyword">range</span> works&#123;
		worker.in &lt;- <span class="hljs-string">&#x27;a&#x27;</span> + i
		wg.Add(<span class="hljs-number">1</span>)
	&#125;

	<span class="hljs-keyword">for</span> i, worker := <span class="hljs-keyword">range</span> works&#123;
		worker.in &lt;- <span class="hljs-string">&#x27;A&#x27;</span> + i
		wg.Add(<span class="hljs-number">1</span>)
	&#125;

	wg.Wait()
&#125;


<span class="hljs-keyword">type</span> WorkerWG2 <span class="hljs-keyword">struct</span> &#123;
	in <span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>
	done <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span>  // 函数式编程</span>
&#125;

<span class="hljs-comment">// WorkerWG封装</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">doWorkWaitDone2</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>, w WorkerWG2)</span></span>  &#123;
	<span class="hljs-comment">// 接收方判断channel中有数据就不断的从channel取</span>
	<span class="hljs-keyword">for</span> n := <span class="hljs-keyword">range</span> w.in&#123;
		fmt.Printf(<span class="hljs-string">&quot;channel %d receive %c\n&quot;</span>, id, n)
		w.done()
	&#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">createWaitDoneWorkers2</span><span class="hljs-params">(id <span class="hljs-keyword">int</span>, wg *sync.WaitGroup)</span> <span class="hljs-title">WorkerWG2</span></span> &#123;
	w := WorkerWG2&#123;
		in: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-keyword">int</span>),
		done: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
			wg.Done()
		&#125;,
	&#125;
	<span class="hljs-keyword">go</span> doWorkWaitDone2(id, w)
	<span class="hljs-keyword">return</span> w
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">communicateWaitDone2</span><span class="hljs-params">()</span></span>  &#123;
	<span class="hljs-comment">// 只能发数据  chan&lt;- int 将channel 作为函数返回参数  即 channel也是一等公民</span>
	<span class="hljs-keyword">var</span> works [<span class="hljs-number">10</span>]WorkerWG2
	<span class="hljs-keyword">var</span> wg sync.WaitGroup
	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;
		works[i] = createWaitDoneWorkers2(i, &amp;wg)
	&#125;

	wg.Add(<span class="hljs-number">20</span>)
	<span class="hljs-keyword">for</span> i, worker := <span class="hljs-keyword">range</span> works&#123;
		worker.in &lt;- <span class="hljs-string">&#x27;a&#x27;</span> + i
		<span class="hljs-comment">//wg.Add(1)</span>
	&#125;
	<span class="hljs-keyword">for</span> i, worker := <span class="hljs-keyword">range</span> works&#123;
		worker.in &lt;- <span class="hljs-string">&#x27;A&#x27;</span> + i
		<span class="hljs-comment">//wg.Add(1)</span>
	&#125;
	wg.Wait()
&#125;

<span class="hljs-comment">// 输出</span>
channel <span class="hljs-number">7</span> receive h
channel <span class="hljs-number">5</span> receive f
channel <span class="hljs-number">6</span> receive g
channel <span class="hljs-number">0</span> receive a
channel <span class="hljs-number">8</span> receive i
channel <span class="hljs-number">1</span> receive b
channel <span class="hljs-number">3</span> receive d
channel <span class="hljs-number">2</span> receive c
channel <span class="hljs-number">4</span> receive e
channel <span class="hljs-number">9</span> receive j
channel <span class="hljs-number">9</span> receive J
channel <span class="hljs-number">3</span> receive D
channel <span class="hljs-number">0</span> receive A
channel <span class="hljs-number">5</span> receive F
channel <span class="hljs-number">2</span> receive C
channel <span class="hljs-number">4</span> receive E
channel <span class="hljs-number">6</span> receive G
channel <span class="hljs-number">1</span> receive B
channel <span class="hljs-number">7</span> receive H
channel <span class="hljs-number">8</span> receive I
channel <span class="hljs-number">9</span> receive j
channel <span class="hljs-number">6</span> receive g
channel <span class="hljs-number">8</span> receive i
channel <span class="hljs-number">4</span> receive e
channel <span class="hljs-number">0</span> receive a
channel <span class="hljs-number">0</span> receive A
channel <span class="hljs-number">2</span> receive c
channel <span class="hljs-number">3</span> receive d
channel <span class="hljs-number">5</span> receive f
channel <span class="hljs-number">1</span> receive b
channel <span class="hljs-number">1</span> receive B
channel <span class="hljs-number">7</span> receive h
channel <span class="hljs-number">7</span> receive H
channel <span class="hljs-number">3</span> receive D
channel <span class="hljs-number">5</span> receive F
channel <span class="hljs-number">4</span> receive E
channel <span class="hljs-number">6</span> receive G
channel <span class="hljs-number">9</span> receive J
channel <span class="hljs-number">2</span> receive C
channel <span class="hljs-number">8</span> receive I</code></pre>

<ul>
<li><code>Mutux</code></li>
</ul>
<pre><code class="hljs golang"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Author: Wang P</span>
<span class="hljs-comment"> * Version: 1.0.0</span>
<span class="hljs-comment"> * Date: 2021/2/5 下午2:34</span>
<span class="hljs-comment"> * Description:</span>
<span class="hljs-comment"> **/</span>

<span class="hljs-keyword">package</span> goroutines

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;fmt&quot;</span>
	<span class="hljs-string">&quot;sync&quot;</span>
	<span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">type</span> AtomicInt <span class="hljs-keyword">struct</span> &#123;
	value <span class="hljs-keyword">int</span>
	lock sync.Mutex
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *AtomicInt)</span> <span class="hljs-title">increase</span><span class="hljs-params">()</span></span>  &#123;
	fmt.Println(<span class="hljs-string">&quot;safe Increase&quot;</span>)
	<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#123;
		<span class="hljs-comment">//a.lock.Lock()</span>
		<span class="hljs-comment">//defer a.lock.Unlock()</span>
		a.value++
	&#125;()
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *AtomicInt)</span> <span class="hljs-title">get</span><span class="hljs-params">()</span> <span class="hljs-title">int</span></span> &#123;
	<span class="hljs-comment">//a.lock.Lock()</span>
	<span class="hljs-comment">//defer a.lock.Unlock()</span>
	<span class="hljs-keyword">return</span> a.value
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AtomicDemo</span><span class="hljs-params">()</span></span>  &#123;
	 i := AtomicInt&#123;&#125;
	 i.increase()
	 <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
	 	i.increase()
	 &#125;()
	time.Sleep(time.Millisecond)
	 fmt.Println(i.get())
&#125;


<span class="hljs-comment">// 输出</span>
xxx@xxxdeMacBook-Pro  ~/Projects/golang/src/offer/note   master ±✚  <span class="hljs-keyword">go</span> run -race main.<span class="hljs-keyword">go</span>
safe Increase
safe Increase
==================
WARNING: DATA RACE
Read at <span class="hljs-number">0x00c000134010</span> by main goroutine:
  offer/note/goroutines.(*AtomicInt).get()
      /Users/wangpeng/Projects/golang/src/offer/note/goroutines/atomic.<span class="hljs-keyword">go</span>:<span class="hljs-number">33</span> +<span class="hljs-number">0xab</span>
  offer/note/goroutines.AtomicDemo()
      /Users/wangpeng/Projects/golang/src/offer/note/goroutines/atomic.<span class="hljs-keyword">go</span>:<span class="hljs-number">43</span> +<span class="hljs-number">0xb4</span>
  main.main()
      /Users/wangpeng/Projects/golang/src/offer/note/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">75</span> +<span class="hljs-number">0x2f</span>

Previous write at <span class="hljs-number">0x00c000134010</span> by goroutine <span class="hljs-number">7</span>:
  offer/note/goroutines.(*AtomicInt).increase.func1()
      /Users/wangpeng/Projects/golang/src/offer/note/goroutines/atomic.<span class="hljs-keyword">go</span>:<span class="hljs-number">26</span> +<span class="hljs-number">0xbd</span>
  offer/note/goroutines.(*AtomicInt).increase()
      /Users/wangpeng/Projects/golang/src/offer/note/goroutines/atomic.<span class="hljs-keyword">go</span>:<span class="hljs-number">27</span> +<span class="hljs-number">0x9e</span>
  offer/note/goroutines.AtomicDemo.func1()
      /Users/wangpeng/Projects/golang/src/offer/note/goroutines/atomic.<span class="hljs-keyword">go</span>:<span class="hljs-number">40</span> +<span class="hljs-number">0x38</span>

Goroutine <span class="hljs-number">7</span> (finished) created at:
  offer/note/goroutines.AtomicDemo()
      /Users/wangpeng/Projects/golang/src/offer/note/goroutines/atomic.<span class="hljs-keyword">go</span>:<span class="hljs-number">39</span> +<span class="hljs-number">0x90</span>
  main.main()
      /Users/wangpeng/Projects/golang/src/offer/note/main.<span class="hljs-keyword">go</span>:<span class="hljs-number">75</span> +<span class="hljs-number">0x2f</span>
==================
<span class="hljs-number">2</span>
Found <span class="hljs-number">1</span> data race(s)
exit status <span class="hljs-number">66</span>
</code></pre>

<pre><code class="hljs golang"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Author: Wang P</span>
<span class="hljs-comment"> * Version: 1.0.0</span>
<span class="hljs-comment"> * Date: 2021/2/5 下午2:34</span>
<span class="hljs-comment"> * Description:</span>
<span class="hljs-comment"> **/</span>

<span class="hljs-keyword">package</span> goroutines

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">&quot;fmt&quot;</span>
	<span class="hljs-string">&quot;sync&quot;</span>
	<span class="hljs-string">&quot;time&quot;</span>
)

<span class="hljs-keyword">type</span> AtomicInt <span class="hljs-keyword">struct</span> &#123;
	value <span class="hljs-keyword">int</span>
	lock sync.Mutex
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *AtomicInt)</span> <span class="hljs-title">increase</span><span class="hljs-params">()</span></span>  &#123;
	fmt.Println(<span class="hljs-string">&quot;safe Increase&quot;</span>)
	<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>&#123;
		a.lock.Lock()
		<span class="hljs-keyword">defer</span> a.lock.Unlock()
		a.value++
	&#125;()
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *AtomicInt)</span> <span class="hljs-title">get</span><span class="hljs-params">()</span> <span class="hljs-title">int</span></span> &#123;
	a.lock.Lock()
	<span class="hljs-keyword">defer</span> a.lock.Unlock()
	<span class="hljs-keyword">return</span> a.value
&#125;

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AtomicDemo</span><span class="hljs-params">()</span></span>  &#123;
	 i := AtomicInt&#123;&#125;
	 i.increase()
	 <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;
	 	i.increase()
	 &#125;()
	time.Sleep(time.Millisecond)
	 fmt.Println(i.get())
&#125;


<span class="hljs-comment">// 输出</span>
xxx@xxxdeMacBook-Pro  ~/Projects/golang/src/offer/note   master ±✚  <span class="hljs-keyword">go</span> run -race main.<span class="hljs-keyword">go</span>
safe Increase
safe Increase
<span class="hljs-number">2</span></code></pre>

<ul>
<li><code>Cond</code></li>
</ul>
<h3 id="包管理"><a href="#包管理" class="headerlink" title="包管理"></a>包管理</h3><h4 id="gopm-获取无法下载的包"><a href="#gopm-获取无法下载的包" class="headerlink" title="gopm 获取无法下载的包"></a>gopm 获取无法下载的包</h4><p><code>go get -v github.com/gpmgo/gopm</code></p>
<p>github地址：<a target="_blank" rel="noopener" href="https://github.com/gpmgo/gopm">https://github.com/gpmgo/gopm</a></p>
<p>文档路径：<a target="_blank" rel="noopener" href="https://github.com/gpmgo/docs/tree/master/zh-CN">https://github.com/gpmgo/docs/tree/master/zh-CN</a></p>
<p>安装踩坑：</p>
<pre><code class="hljs zsh">github.com/codegangsta/cli: github.com/codegangsta/cli@v1.22.5: parsing go.mod:
		module declares its path as: github.com/urfave/cli
	        but was required as: github.com/codegangsta/cli</code></pre>

<p>关闭go mod即可成功安装</p>
<h3 id="常见库-框架"><a href="#常见库-框架" class="headerlink" title="常见库/框架"></a>常见库/框架</h3><h4 id="爬虫相关"><a href="#爬虫相关" class="headerlink" title="爬虫相关"></a>爬虫相关</h4><ul>
<li>henrylee2cn/pholcus</li>
<li>gocrawl</li>
<li>colly</li>
<li>hu17889/go_spider</li>
</ul>
<h4 id="原生库"><a href="#原生库" class="headerlink" title="原生库"></a>原生库</h4><h5 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h5><p>实现了程序命令行参数的解析。</p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Golang/">Golang</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Golang/">Golang</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2021/03/05/lt-linkedList/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">【LeetCode】线性表相关问题</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2021/01/11/ml/">
                        <span class="hidden-mobile">【ML】机器学习概述与简单应用</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Wei</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/weitrue" target="_blank" rel="nofollow noopener">
        <span>Trable</span></a>
    </div>
    

    
  <!-- 备案信息 -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">杭ICP证123456号</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/images/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>杭公网安备12345678号</span>
      </a>
     
  </div>


    
     <div>
  	<span id="timeDate">载入天数...</span>
 	<span id="times">载入时分秒...</span>
 	<script>
          var now = new Date();
          function createtime(){
           var grt= new Date("02/14/2020 00:00:00");//此处修改你的建站时间或者网站上线时间
           now.setTime(now.getTime()+250);
           days = (now - grt ) / 1000 / 60 / 60 / 24;
           dnum = Math.floor(days);
           hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
           hnum = Math.floor(hours);
           if(String(hnum).length ==1 ){
                hnum = "0" + hnum;
           }
           minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
           mnum = Math.floor(minutes);
           if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
           }
           seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
           snum = Math.round(seconds);
           if(String(snum).length ==1 ){
                snum = "0" + snum;
           }
           document.getElementById("timeDate").innerHTML = "本站安全运行&nbsp"+dnum+"&nbsp天";
           document.getElementById("times").innerHTML = hnum + "&nbsp小时&nbsp" + mnum + "&nbsp分&nbsp" + snum + "&nbsp秒";
          }
          setInterval("createtime()",250);
       </script>
    </div>
 </div>
 </footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "【Go】学习笔记&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script type="text/javascript">
      //定义获取词语下标
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //点击body时触发事件
        $("body").click(function (e) {
          //需要显示的词语
          var a = new Array("富强", "民主", "文明", "和谐", "自由", "平等", "公正", "法治", "爱国", "敬业", "诚信", "友善");
          //设置词语给span标签
          var $i = $("<span/>").text(a[a_idx]);
          //下标等于原来下标+1  余 词语总数
          a_idx = (a_idx + 1) % a.length;
          //获取鼠标指针的位置，分别相对于文档的左和右边缘。
          //获取x和y的指针坐标
          var x = e.pageX, y = e.pageY;
          //在鼠标的指针的位置给$i定义的span标签添加css样式
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // 随机颜色
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //在body添加这个标签
          $("body").append($i);
          //animate() 方法执行 CSS 属性集的自定义动画。
          //该方法通过CSS样式将元素从一个状态改变为另一个状态。CSS属性值是逐渐改变的，这样就可以创建动画效果。
          //详情请看http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //将原来的位置向上移动180
            "top": y - 180,
            "opacity": 0
            //1500动画的速度
          }, 1500, function () {
            //时间到了自动删除
            $i.remove();
          });
        });
      })
      ;
    </script>
  











  

  

  

  

  

  





<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
